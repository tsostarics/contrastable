<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>contrasts</title>

<script src="data:application/javascript;base64,Ly8gUGFuZG9jIDIuOSBhZGRzIGF0dHJpYnV0ZXMgb24gYm90aCBoZWFkZXIgYW5kIGRpdi4gV2UgcmVtb3ZlIHRoZSBmb3JtZXIgKHRvCi8vIGJlIGNvbXBhdGlibGUgd2l0aCB0aGUgYmVoYXZpb3Igb2YgUGFuZG9jIDwgMi44KS4KZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uKGUpIHsKICB2YXIgaHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJkaXYuc2VjdGlvbltjbGFzcyo9J2xldmVsJ10gPiA6Zmlyc3QtY2hpbGQiKTsKICB2YXIgaSwgaCwgYTsKICBmb3IgKGkgPSAwOyBpIDwgaHMubGVuZ3RoOyBpKyspIHsKICAgIGggPSBoc1tpXTsKICAgIGlmICghL15oWzEtNl0kL2kudGVzdChoLnRhZ05hbWUpKSBjb250aW51ZTsgIC8vIGl0IHNob3VsZCBiZSBhIGhlYWRlciBoMS1oNgogICAgYSA9IGguYXR0cmlidXRlczsKICAgIHdoaWxlIChhLmxlbmd0aCA+IDApIGgucmVtb3ZlQXR0cmlidXRlKGFbMF0ubmFtZSk7CiAgfQp9KTsK"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="data:text/css,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" type="text/css" />




</head>

<body>




<h1 class="title toc-ignore">contrasts</h1>



<p>This vignette describes some of the contrast coding helpers this package provides. It should be noted that this package does not seek to provide an interface for creating hypothesis matrices and their respective contrast matrices. For that functionality you might look into the <code>multcomp</code> or <code>hypr</code> packages. The contrast functionality of this package is focused on the following:</p>
<ul>
<li>Easily implement commonly used contrast coding schemes</li>
<li>Make reference levels explicit</li>
<li>Cut down on repetitive coding involved in setting contrasts</li>
<li>Retain interpretable labels in model summary coefficients</li>
<li>Allow the implementation of custom contrasts (but again not their creation)</li>
</ul>
<p>This vignette will not go into detail how different contrast schemes are derived or interpreted, but will describe some of the high level differences. I recommend reading the following:</p>
<ul>
<li><a href="https://stats.idre.ucla.edu/r/library/r-library-contrast-coding-systems-for-categorical-variables/">UCLA R Library Contrast Coding Systems for Categorical Variables</a></li>
<li><a href="https://www.sciencedirect.com/science/article/pii/S0749596X19300695">How to capitalize on a priori contrasts in linear (mixed) models: A tutorial</a></li>
<li><a href="https://osf.io/pnumg/">Regresion modeling for linguistic data (preprint)</a></li>
</ul>
<p>There is a very small overview of hypothesis matrices in the second to last section, but I will not provide a discussion of orthogonality as it relates to contrasts.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sostools)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>mdl_data <span class="ot">&lt;-</span> </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cyl =</span> <span class="fu">factor</span>(cyl), </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">twolevel =</span> <span class="fu">round</span>(<span class="fu">runif</span>(<span class="fu">n</span>()),<span class="dv">0</span>),</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">twolevel =</span> <span class="fu">ifelse</span>(twolevel <span class="sc">==</span> <span class="dv">1</span>, <span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>),</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">twolevel =</span> <span class="fu">factor</span>(twolevel),</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">gear =</span> <span class="fu">factor</span>(gear),</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">carb =</span> <span class="fu">factor</span>(carb))</span></code></pre></div>
<div id="motivation" class="section level2">
<h2>Motivation</h2>
<p>The default contrast scheme for factors in R is <strong>treatment coding</strong>, which tests the difference between each level of a factor and the level set as the reference level. Often this doesn’t correspond to hypotheses we want to test, so we need to change it ourselves.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(mdl_data<span class="sc">$</span>twolevel)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   b</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; a 0</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; b 1</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(mdl_data<span class="sc">$</span>carb)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   2 3 4 6 8</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 0 0 0 0 0</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 1 0 0 0 0</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 0 1 0 0 0</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 0 0 1 0 0</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 0 0 0 1 0</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 8 0 0 0 0 1</span></span></code></pre></div>
<p>Typically we would change these manually using <code>contrasts&lt;-</code>, for example this would implement R’s built in sum coding for a 6 level factor.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(mdl_data<span class="sc">$</span>carb) <span class="ot">&lt;-</span> <span class="fu">contr.sum</span>(<span class="dv">6</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(mdl_data<span class="sc">$</span>carb)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   [,1] [,2] [,3] [,4] [,5]</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1    1    0    0    0    0</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2    0    1    0    0    0</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3    0    0    1    0    0</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4    0    0    0    1    0</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6    0    0    0    0    1</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 8   -1   -1   -1   -1   -1</span></span></code></pre></div>
<p>Compare this contrast matrix to the treatment coded matrix previously shown for this factor. There are two things to note here. First, in the treatment coded matrix the <em>first row</em> corresponding to level 1 was all 0, denoting 1 as the reference level, but here the reference level is actually level 8, which has all -1s. This may not be what you intended. Second, the <strong>column names have changed</strong>. The column names represent the labels for the comparisons we’re making with our contrast matrix. In the treatment coded matrix, the labels are <code>c(2, 3, 4, 6, 8)</code>, which would be shown in the coefficient names in a model summary. In the matrix from <code>contr.sum(6)</code>, they’re not the same. Notably, what would correspond to the comparison for level 6 would be displayed as <code>carb5</code> in our model output! We’d like to have meaningful labels that make it easier to interpret.</p>
<p>Occasionally people will mention that there’s a “standard”, “tradition”, or “convention” that <code>coef1</code> corresponds to something. This isn’t really the case, it’s only a “convention” because people are unknowingly erasing or not setting the labels themselves. There’s no reason to need to keep track of what 1 represents for all your categorical variables in your head, as you’ll likely make a mistake.</p>
</div>
<div id="contrast-coding" class="section level2">
<h2>Contrast coding</h2>
<p>This package provides a useful function called <code>contrast_code()</code> which takes a factor column and a desired contrast scheme and returns a new contrast matrix. The contrast scheme can be passed as either a function that generates contrast matrices, such as <code>contr.sum</code>, or a matrix you’ve created yourself.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">contrast_code</span>(mdl_data<span class="sc">$</span>carb, contr.sum)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    2  3  4  6  8</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 -1 -1 -1 -1 -1</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2  1  0  0  0  0</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3  0  1  0  0  0</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4  0  0  1  0  0</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6  0  0  0  1  0</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 8  0  0  0  0  1</span></span></code></pre></div>
<p>There are two things to note here. First, the comparison labels have been retained. This makes model intepretation easier. Second, the reference level has been set to the first level alphabetically, rather than the last level. This is the default behavior, but can be set to whatever you want.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">contrast_code</span>(mdl_data<span class="sc">$</span>carb, contr.sum, <span class="at">reference_level =</span> <span class="dv">4</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    1  2  3  6  8</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  1  0  0  0  0</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2  0  1  0  0  0</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3  0  0  1  0  0</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 -1 -1 -1 -1 -1</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6  0  0  0  1  0</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 8  0  0  0  0  1</span></span></code></pre></div>
<p>Note how the comparison labels have also changed appropriately.</p>
<p>The setting of reference levels only applies to schemes that utilize a reference level. These include the following functions:</p>
<ul>
<li><code>contr.sum</code>: compare each non-reference level to the grand mean</li>
<li><code>contr.treatment</code>: compare each level to the reference level (intercept = mean of reference level)</li>
<li><code>scaled_sum_code</code>: compare each level to the reference level (intercept = grand mean)</li>
</ul>
<p>The following schemes depend on a particular order of factors. By default, R orders levels alphabetically. If this isn’t what you want, use <code>levels&lt;-</code> to change the ordering manually before applying contrasts coding.</p>
<ul>
<li><code>forward_difference_code</code>: compare each level k to level k+1 (eg 1-2, 2-3)</li>
<li><code>backward_difference_code</code>: compare each level k to level k-1 (eg 3-2, 2-1)</li>
<li><code>helmert_code</code>: compare each level k to the mean of all levels above it (eg &gt;1, &gt;2)</li>
<li><code>reverse_helmert_code</code>: compare each level k to the mean of all levels below if (eg &lt;2, &lt;3)</li>
</ul>
<p>Orthogonal polynomial contrasts with <code>contr.poly</code> are typically used to identify trends in ordinal predictors. In fact, just as <code>contr.treatment</code> is the default contrast setting for unordered factors in R, <code>contr.poly</code> is the default for ordered factors. Nonetheless, orthogonal polynomial contrasts aren’t used for group comparisons, so the “comparison” labels are different. But this isn’t an issue, and will still work as expected.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">contrast_code</span>(mdl_data<span class="sc">$</span>carb, contr.poly)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;           .L         .Q         .C         ^4          ^5</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 -0.5976143  0.5455447 -0.3726780  0.1889822 -0.06299408</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 -0.3585686 -0.1091089  0.5217492 -0.5669467  0.31497039</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 -0.1195229 -0.4364358  0.2981424  0.3779645 -0.62994079</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4  0.1195229 -0.4364358 -0.2981424  0.3779645  0.62994079</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6  0.3585686 -0.1091089 -0.5217492 -0.5669467 -0.31497039</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 8  0.5976143  0.5455447  0.3726780  0.1889822  0.06299408</span></span></code></pre></div>
</div>
<div id="utilizing-contrasts-argument-in-model-functions" class="section level2">
<h2>Utilizing <code>contrasts</code> argument in model functions</h2>
<p>Rather than manually setting the contrasts on the data frame itself, you can also utilize the contrasts argument in functions like <code>lm</code>, which take a named list of contrast matrices where the names correspond to factor predictors. This package provides a function <code>enlist_contrasts</code> to take advantage of this. Make sure your model fitting function supports this argument, as <code>brm</code> does not use this (see the next section for a workaround).</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>my_contrasts <span class="ot">&lt;-</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">enlist_contrasts</span>(mdl_data,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                   cyl <span class="sc">~</span> contr.sum <span class="sc">+</span> <span class="dv">6</span>, <span class="co"># Set the reference level with + ___</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>                   twolevel <span class="sc">~</span> scaled_sum_code <span class="sc">+</span> <span class="st">&quot;a&quot;</span>,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>                   gear <span class="sc">~</span> forward_difference_code,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>                   carb <span class="sc">~</span> helmert_code)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>my_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(mpg <span class="sc">~</span> cyl <span class="sc">+</span> twolevel <span class="sc">+</span> gear <span class="sc">+</span> carb, </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> mdl_data,  </span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">contrasts =</span> my_contrasts)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(my_model)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Call:</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; lm(formula = mpg ~ cyl + twolevel + gear + carb, data = mdl_data, </span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     contrasts = my_contrasts)</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Residuals:</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     Min      1Q  Median      3Q     Max </span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; -4.2690 -1.8577 -0.2335  1.2946  5.4821 </span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Coefficients:</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; (Intercept)  19.5029     0.8851  22.034 5.36e-16 ***</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; cyl4          1.5626     1.5715   0.994   0.3314    </span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; cyl8         -1.5413     1.5980  -0.965   0.3457    </span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; twolevelb     2.0493     1.1724   1.748   0.0951 .  </span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; gear3-4      -6.3872     2.2672  -2.817   0.0103 *  </span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; gear4-5      -0.2447     2.0279  -0.121   0.9051    </span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; carb&gt;1        5.9767     2.4381   2.451   0.0231 *  </span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; carb&gt;2        4.7821     2.1133   2.263   0.0344 *  </span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; carb&gt;3        6.6296     2.8863   2.297   0.0320 *  </span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; carb&gt;4        3.2354     2.9499   1.097   0.2851    </span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; carb&gt;6        3.1800     4.6687   0.681   0.5032    </span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ---</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Residual standard error: 2.916 on 21 degrees of freedom</span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Multiple R-squared:  0.8415, Adjusted R-squared:  0.766 </span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; F-statistic: 11.15 on 10 and 21 DF,  p-value: 2.508e-06</span></span></code></pre></div>
<p>The left hand side of each formula in <code>enlist_contrasts</code> should be the unquoted name of a factor column, and the right hand side should be of the following:</p>
<ul>
<li>An unquoted function name that generates contrast matrices</li>
<li><strong><em>OR</em></strong> An unquoted variable name that’s assigned to a contrast matrix</li>
<li><strong><em>OR</em></strong> A <code>matrix()</code> call, which will be captured and evaluated</li>
<li><strong><em>AND</em></strong> An optional reference level when applicable, following a <code>+</code>. String names should be quoted, if the label happens to be numeric you can leave the number unquoted. You can also use an unquoted variable name that contains the reference level.</li>
<li><strong><em>AND</em></strong> An optional specification for which level to use as the intercept following a <code>*</code>. Same syntax as the reference level, see section titled “Changing Underlying Intercept”</li>
<li><strong><em>AND</em></strong> If you use polynomial contrasts, an optional sequence (integer vector) of which trends you would like to drop following a <code>-</code>. Typically of the form <code>- a:b</code> where a and b are integers (eg <code>- 3:5</code> to drop cubic through 5th power trends)</li>
</ul>
<p>When using this method you should set contrasts for all factors. You’ll receive a message if you don’t set one or more, along with what the default contrasts are as specified by <code>options(&#39;contrasts&#39;)</code> for both ordered and unordered factors. While not shown in this vignette, these are also color coded (blue for unordered, red for ordered).</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>contrast_list <span class="ot">&lt;-</span> <span class="fu">enlist_contrasts</span>(mdl_data, carb <span class="sc">~</span> helmert_code)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; You didn&#39;t set these factors, expect contr.treatment or contr.poly: cyl gear twolevel</span></span></code></pre></div>
</div>
<div id="setting-multiple-contrasts-at-once" class="section level2">
<h2>Setting multiple contrasts at once</h2>
<p>As previously mentioned, the <code>brm</code> function from the <code>brms</code> package (used to fit bayesian models) does not have a <code>contrasts</code> argument. This means we need to set the contrasts on the dataframe itself. But, this doesn’t mean we need to revert to multiple <code>contrasts&lt;-</code> lines. We can use <code>set_contrasts</code>, which uses the same syntax as <code>enlist_contrasts</code> but returns a new copy of the dataframe where the factor levels are set. The usual warnings and messages still apply.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>mdl_data2 <span class="ot">&lt;-</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_contrasts</span>(mdl_data,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>                cyl <span class="sc">~</span> contr.sum <span class="sc">+</span> <span class="dv">6</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>                twolevel <span class="sc">~</span> scaled_sum_code <span class="sc">+</span> <span class="st">&quot;a&quot;</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>                gear <span class="sc">~</span> forward_difference_code,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>                carb <span class="sc">~</span> helmert_code)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(mdl_data<span class="sc">$</span>carb)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   2 3 4 6 8</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 0 0 0 0 0</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 1 0 0 0 0</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 0 1 0 0 0</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 0 0 1 0 0</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 0 0 0 1 0</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 8 0 0 0 0 1</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(mdl_data2<span class="sc">$</span>carb) <span class="sc">%&gt;%</span> <span class="fu">fractions</span>()</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &gt;1   &gt;2   &gt;3   &gt;4   &gt;6  </span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  5/6    0    0    0    0</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 -1/6  4/5    0    0    0</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 -1/6 -1/5  3/4    0    0</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 -1/6 -1/5 -1/4  2/3    0</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 -1/6 -1/5 -1/4 -1/3  1/2</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 8 -1/6 -1/5 -1/4 -1/3 -1/2</span></span></code></pre></div>
<p>One other thing to know is that when calling <code>get_prior</code> or setting priors for coefficients in general, <code>brms</code> actually changes the names slightly when prepping the model for running in stan. For example, using backward difference coding gives coefficient names like <code>2-1</code>, but this gets changed to <code>2M1</code>. If you’re doing programmatic setting of priors or something, it’s something to keep in mind. Maybe I’ll add some functionality around this in the future.</p>
</div>
<div id="note-about-2-level-factors" class="section level2">
<h2>Note about 2 level factors</h2>
<p>Coding factors with only 2 levels is a bit tricky conceptually because there is only one possible comparison you can make: level A to level B. Thus, many of the different coding schemes end up being mathematically equivalent.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">helmert_code</span>(<span class="dv">2</span>) <span class="co"># Compare k to &gt;k</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      [,1]</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1,]  0.5</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2,] -0.5</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="fu">scaled_sum_code</span>(<span class="dv">2</span>) <span class="co"># Compare k to reference level</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   [,1]</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  0.5</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 -0.5</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="fu">forward_difference_code</span>(<span class="dv">2</span>) <span class="co"># Compare k to k+1</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      [,1]</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1,]  0.5</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2,] -0.5</span></span></code></pre></div>
<p>In many introductions to contrast coding, the motivation for using <code>+/-.5</code> is something like this:</p>
<ul>
<li><code>0, 1</code> from <code>contr.treatment(2)</code> puts the intercept at the reference level, which we don’t always want</li>
<li><code>-1, 1</code> from <code>-contr.sum(2)</code> keeps the same reference level and the intercept is now the grand mean, but this tests half the difference between levels (i.e., the distance between a level and the intercept)</li>
<li><code>-.5, .5</code> from <code>-contr.sum(2)/2</code> scales the estimate so it tests the full difference between levels.</li>
</ul>
<p>All of this is true, but it leads to an issue when naively extending this line of thinking beyond 2 levels. That is, one might be tempted to use the following matrix for “sum coding a 4 level factor”</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fu">contr.sum</span>(<span class="dv">4</span>)<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   [,1] [,2] [,3]</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 -0.5  0.0  0.0</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2  0.0 -0.5  0.0</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3  0.0  0.0 -0.5</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4  0.5  0.5  0.5</span></span></code></pre></div>
<p>Yet, this contrast matrix <strong><em>does not</em></strong> test the hypotheses that <span class="math inline">\(\mu_1=\mu_4\)</span> and <span class="math inline">\(\mu_2=\mu_4\)</span> and <span class="math inline">\(\mu_3=\mu_1\)</span> in the same way that the 2 level matrix tested <span class="math inline">\(\mu_1=\mu_2\)</span>. Rather, it tests the hypothesis that <span class="math inline">\(1.5\mu_1 =.5\mu_2+.5\mu_3 + .5\mu_4\)</span> etc. To actually compare, and test the difference between, each level and the reference level, you need to use the following matrix, which this package provides a helper for:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">scaled_sum_code</span>(<span class="dv">4</span>) <span class="sc">%&gt;%</span> MASS<span class="sc">::</span><span class="fu">fractions</span>()</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   [,1] [,2] [,3]</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  3/4 -1/4 -1/4</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 -1/4  3/4 -1/4</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 -1/4 -1/4  3/4</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 -1/4 -1/4 -1/4</span></span></code></pre></div>
<p>We can verify this by looking at the hypothesis matrices.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Not what we want</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="sc">-</span><span class="fu">contr.sum</span>(<span class="dv">4</span>)<span class="sc">/</span><span class="dv">2</span>), <span class="at">nrow =</span> <span class="dv">4</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">%&gt;%</span> <span class="fu">solve</span>() <span class="sc">%&gt;%</span> <span class="fu">fractions</span>()</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      [,1] [,2] [,3] [,4]</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1,]  1/4 -3/2  1/2  1/2</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2,]  1/4  1/2 -3/2  1/2</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [3,]  1/4  1/2  1/2 -3/2</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [4,]  1/4  1/2  1/2  1/2</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Actually what we want</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="fu">scaled_sum_code</span>(<span class="dv">4</span>)), <span class="at">nrow =</span> <span class="dv">4</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">%&gt;%</span> <span class="fu">solve</span>() <span class="sc">%&gt;%</span> <span class="fu">fractions</span>()</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      [,1] [,2] [,3] [,4]</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1,] 1/4    1    0    0 </span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2,] 1/4    0    1    0 </span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [3,] 1/4    0    0    1 </span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [4,] 1/4   -1   -1   -1</span></span></code></pre></div>
<p>Rather than thinking about “testing half the difference,” framing things in terms of the underlying hypothesis matrix being tested is more generalizable. Assume level 1 is <code>A</code> (and is the reference level) and level 2 is <code>B</code> in these descriptions:</p>
<ul>
<li><code>0, 1</code> from <code>contr.treatment(2)</code> puts the intercept at the reference level and tests the difference <span class="math inline">\(\mu_B-\mu_A\)</span>. Each comparison tests a distance from the reference level. We use the term <em>treatment coding</em>.</li>
<li><code>-1, 1</code> from <code>-contr.sum(2)</code> puts the intercept at the grand mean (<span class="math inline">\(GM=\frac{\mu_A+\mu_B}{2}\)</span>) and tests the difference <span class="math inline">\(\mu_B - GM\)</span>. Each comparison tests a distance from the grand mean. We use the term <em>sum coding</em></li>
<li><code>-.5, .5</code> from <code>-contr.sum(2)/2</code> puts the intercept at the grand mean and tests the difference <span class="math inline">\(\mu_B - \mu_A\)</span>. Each comparison tests a distance from the reference level. We use the term <em>scaled sum coding</em>.</li>
</ul>
<p>It’s worth noting that the terms “sum coding” and “scaled sum coding” are <strong><em>not</em></strong> consistent across disciplines. Other terms that are used are simple coding, deviation coding, sum to zero coding, and contrast coding. When referring specifically to coding factors with 2 levels, sometimes the numbers are used as in 0/1 coding, -1/1 coding, -.5/+.5 coding. I recommend that you choose a term from your discipline and stick to it, but also provide the exact contrast or hypothesis matrices in an appendix, preregistration, or supplementary material.</p>
</div>
<div id="changing-underlying-intercept" class="section level2">
<h2>Changing Underlying Intercept</h2>
<p>I know I said I wouldn’t give a discussion on how contrasts are derived, but there’s one additional functionality that kind of necessitates describing the process a little. We know that contrast matrices have <span class="math inline">\(k\)</span> rows and <span class="math inline">\(k-1\)</span> columns for our <span class="math inline">\(k-1\)</span> comparisons (derived from <span class="math inline">\(k-1\)</span> degrees of freedom). But models also give an intercept term: where does that come from? Moreover, why is it conveniently the grand mean for basically everything but treatment coding? What if I wanted a particular coding scheme for my level comparisons, but the intercept representing the mean of my highest level rather than the grand mean (which might not be meaningful)? Is this possible?</p>
<p>First, recall that scaled sum coding puts the intercept at the grand mean and the comparisons are between the reference level and the level being compared.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fractions</span>(<span class="fu">scaled_sum_code</span>(<span class="dv">4</span>))</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   [,1] [,2] [,3]</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  3/4 -1/4 -1/4</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 -1/4  3/4 -1/4</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 -1/4 -1/4  3/4</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 -1/4 -1/4 -1/4</span></span></code></pre></div>
<p>The intercept in this case is actually represented by an omitted column of 1s</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>,<span class="dv">4</span>),</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>         <span class="fu">scaled_sum_code</span>(<span class="dv">4</span>)),</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">nrow =</span> <span class="dv">4</span>) <span class="sc">%&gt;%</span> <span class="fu">fractions</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      [,1] [,2] [,3] [,4]</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1,]    1  3/4 -1/4 -1/4</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2,]    1 -1/4  3/4 -1/4</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [3,]    1 -1/4 -1/4  3/4</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [4,]    1 -1/4 -1/4 -1/4</span></span></code></pre></div>
<p>Why are there fractions though? If I’m comparing level 1 to level 2, why aren’t the others 0? Why aren’t they just 0 compared to 1, like in treatment coding? This intuition is actually valid; not at the level of the contrasts but at the level of the hypotheses you want to test. Turns out those hypotheses actually underlie this matrix, and linear algebra transformations can be used to go between the two. For more details, see the paper on capitalizing on a priori contrasts. For now just know that we can take the inverse of the transpose of a matrix to go between the two (sometimes the transpose is ommitted depending on the author, which means you’d go back and forth between interpreting columns or rows as comparisons).</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>contrast_matrix <span class="ot">&lt;-</span> </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>,<span class="dv">4</span>),</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>           <span class="fu">scaled_sum_code</span>(<span class="dv">4</span>)),</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">nrow =</span> <span class="dv">4</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>hypothesis_matrix <span class="ot">&lt;-</span> <span class="fu">solve</span>(<span class="fu">t</span>(contrast_matrix))</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="fu">fractions</span>(hypothesis_matrix)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      [,1] [,2] [,3] [,4]</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1,] 1/4    1    0    0 </span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2,] 1/4    0    1    0 </span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [3,] 1/4    0    0    1 </span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [4,] 1/4   -1   -1   -1</span></span></code></pre></div>
<p>This gives us our hypothesis matrix, and we can tell from the first column that the intercept is the grand mean because each level contributes to a single value. That is, the sum of the means of our 4 levels, divided by 4, is the grand mean; hence the weight of each mean is 1/4. Our comparisons show that we’re comparing the fourth level (all -1s) to the 1st, 2nd, and 3rd levels for our three comparisons. This is maybe more transparent than the 3/4 and -1/4s in the contrast matrix.</p>
<p>However, consider if we didn’t want the grand mean. What if we wanted the intercept to be a particular level’s mean, say our reference level of 4? Rather than having each level contribute to the intercept, we just want 1. So we can use this matrix:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>hypothesis_matrix2 <span class="ot">&lt;-</span> hypothesis_matrix</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>hypothesis_matrix2[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>hypothesis_matrix2</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      [,1] [,2] [,3] [,4]</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1,]    0    1    0    0</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2,]    0    0    1    0</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [3,]    0    0    0    1</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [4,]    1   -1   -1   -1</span></span></code></pre></div>
<p>Think critically here: Our intercept is now the mean of level 4, the other levels don’t contribute to it. Each comparison is now the difference between a level and the reference level. If that’s the case, we should have just recreated treatment coding! But we need to convert from our hypothesis matrix to the contrast matrix. Remind yourself what the contrast matrix from treatment coding should look like before proceeding (hint: lots of 0s and 1s).</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Inverse of the transpose, remove the first column to get contrasts</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>maybe_treatment_contrasts <span class="ot">&lt;-</span> <span class="fu">solve</span>(<span class="fu">t</span>(hypothesis_matrix2))[,<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># I&#39;m manually reordering to make the reference level the 4th level here</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>definitely_treatment_contrasts <span class="ot">&lt;-</span> <span class="fu">unname</span>(<span class="fu">contr.treatment</span>(<span class="dv">4</span>)[<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">1</span>),])</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>maybe_treatment_contrasts</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      [,1] [,2] [,3]</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1,]    1    0    0</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2,]    0    1    0</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [3,]    0    0    1</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [4,]    0    0    0</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>definitely_treatment_contrasts</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      [,1] [,2] [,3]</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1,]    1    0    0</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2,]    0    1    0</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [3,]    0    0    1</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [4,]    0    0    0</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Moment of truth: Are they the same?!</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a><span class="fu">all</span>(maybe_treatment_contrasts <span class="sc">==</span> definitely_treatment_contrasts)</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>And indeed we recreated treatment coding by changing the underlying hypothesis matrix. That was so much work to get something already available. Consider a harder case of forward difference coding with the intercept changed.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>forward_contrasts <span class="ot">&lt;-</span> <span class="fu">forward_difference_code</span>(<span class="dv">6</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>forward_hypotheses <span class="ot">&lt;-</span> </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>,<span class="dv">6</span>), forward_contrasts), <span class="at">nrow =</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span> <span class="fu">t</span>() <span class="sc">%&gt;%</span> <span class="fu">solve</span>()</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="fu">fractions</span>(forward_contrasts)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5]</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1,]  5/6  2/3  1/2  1/3  1/6</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2,] -1/6  2/3  1/2  1/3  1/6</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [3,] -1/6 -1/3  1/2  1/3  1/6</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [4,] -1/6 -1/3 -1/2  1/3  1/6</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [5,] -1/6 -1/3 -1/2 -2/3  1/6</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [6,] -1/6 -1/3 -1/2 -2/3 -5/6</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="fu">fractions</span>(forward_hypotheses)</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5] [,6]</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1,] 1/6    1    0    0    0    0 </span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2,] 1/6   -1    1    0    0    0 </span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [3,] 1/6    0   -1    1    0    0 </span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [4,] 1/6    0    0   -1    1    0 </span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [5,] 1/6    0    0    0   -1    1 </span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [6,] 1/6    0    0    0    0   -1</span></span></code></pre></div>
<p>Now we’ll change the intercept to level 6.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>new_forward_hypotheses <span class="ot">&lt;-</span> forward_hypotheses</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>new_forward_hypotheses[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>new_forward_hypotheses</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5] [,6]</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1,]    0    1    0    0    0    0</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2,]    0   -1    1    0    0    0</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [3,]    0    0   -1    1    0    0</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [4,]    0    0    0   -1    1    0</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [5,]    0    0    0    0   -1    1</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [6,]    1    0    0    0    0   -1</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>new_forward_contrasts <span class="ot">&lt;-</span> <span class="fu">solve</span>(<span class="fu">t</span>(new_forward_hypotheses))[,<span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>]</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>new_forward_contrasts</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5]</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1,]    1    1    1    1    1</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2,]    0    1    1    1    1</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [3,]    0    0    1    1    1</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [4,]    0    0    0    1    1</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [5,]    0    0    0    0    1</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [6,]    0    0    0    0    0</span></span></code></pre></div>
<p>The matrix changed pretty substantially compared to before, even though all we changed was the intercept. This still required quite a few steps to just change the level we want to be the intercept. Thankfully <code>enlist_contrasts</code> and related functions <code>set_contrasts</code>, <code>contrast_code</code>, and <code>functional_code</code> have an argument to change this more simply.</p>
<p>The syntax for <code>enlist_contrasts</code> and <code>set_contrasts</code> requires putting a <code>*</code> before the name of the level you want to use. If you’re using a reference level, you can also specify that with <code>+</code> as usual. You can also use both, but specifying a reference level is only applicable to schemes where that’s meaningful, like in <code>contr.treatment</code>, <code>contr.sum</code>, and <code>scaled_sum_code</code>. Recall from our earlier derivation that scaled sum coding with the intercept specified as the reference level is equivalent to treatment coding, which should be evident here.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">enlist_contrasts</span>(mdl_data, </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>                 carb <span class="sc">~</span> forward_difference_code <span class="sc">*</span> <span class="dv">8</span>,</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>                 gear <span class="sc">~</span> scaled_sum_code <span class="sc">+</span> <span class="dv">4</span> <span class="sc">*</span> <span class="dv">4</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; You didn&#39;t set these factors, expect contr.treatment or contr.poly: cyl twolevel</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $carb</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   1-2 2-3 3-4 4-6 6-8</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1   1   1   1   1   1</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2   0   1   1   1   1</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3   0   0   1   1   1</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4   0   0   0   1   1</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6   0   0   0   0   1</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 8   0   0   0   0   0</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $gear</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   3 5</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 1 0</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 0 0</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 0 1</span></span></code></pre></div>
<p>Using the singular <code>contrast_code</code> just requires specifying the <code>reference_level</code> and <code>set_intercept</code> arguments as needed.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">contrast_code</span>(mdl_data<span class="sc">$</span>gear, </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>              scaled_sum_code, </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">reference_level =</span> <span class="dv">4</span>, </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">set_intercept =</span> <span class="dv">4</span>)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   3 5</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 1 0</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 0 0</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 0 1</span></span></code></pre></div>
<p>This functionality should only be used when you’re using a function to generate contrasts. Currently, I don’t allow for multiple levels to be used as the intercept (e.g., only 2 of 4 levels). If you really think you need to do that, you probably have a good handle on contrasts and hypothesis matrices, so you should specify the matrix manually yourself and use that as an argument. If you think you need to do that but you <em>don’t</em> have a good handle on contrasts and hypothesis matrices, you should go back and read the paper cited at the top of this vignette again. Remember that when setting matrices yourself, you should specify the row names to be your factor levels and your column names to be informative comparison labels.</p>
</div>
<div id="dropping-trends-from-polynomials" class="section level2">
<h2>Dropping trends from polynomials</h2>
<p>When using polynomial contrasts you can drop higher level trends for the sake of parsimony. However, even when using orthogonal polynomials, your estimates for each trend can differ depending on whether higher trends are included. If you do want to remove higher level trends though, you can use the <code>-</code> operator in the contrast formula. Let’s use the <code>diamonds</code> data set as an example.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2,diamonds) <span class="co"># load just the diamonds dataset</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Clarity has 8 levels, so we&#39;ll remove anything higher than the cubic trend</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>my_contrasts <span class="ot">&lt;-</span> <span class="fu">enlist_contrasts</span>(diamonds,</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>                                 clarity <span class="sc">~</span> contr.poly <span class="sc">-</span> <span class="dv">4</span><span class="sc">:</span><span class="dv">7</span>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; These factors are ordered, you may lose contr.poly: clarity</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; You didn&#39;t set these factors, expect contr.treatment or contr.poly: cut color</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Higher trends removed</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(price <span class="sc">~</span> clarity, <span class="at">data =</span> diamonds, <span class="at">contrasts =</span> my_contrasts) <span class="sc">%&gt;%</span> </span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  broom<span class="sc">::</span><span class="fu">tidy</span>()</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 4 x 5</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   term        estimate std.error statistic   p.value</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 (Intercept)   3796.       22.8   167.    0        </span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 clarity.L    -2346.       85.7   -27.4   1.06e-163</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 clarity.Q      109.       71.9     1.52  1.29e-  1</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 clarity.C      -55.5      72.0    -0.770 4.41e-  1</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Higher trends retained</span></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(price <span class="sc">~</span> clarity, <span class="at">data =</span> diamonds) <span class="sc">%&gt;%</span> </span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>  broom<span class="sc">::</span><span class="fu">tidy</span>()</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 8 x 5</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   term        estimate std.error statistic  p.value</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 (Intercept)   3677.       25.9    142.   0       </span></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 clarity.L    -1723.       98.7    -17.5  4.70e-68</span></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 clarity.Q     -428.       96.7     -4.43 9.45e- 6</span></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 clarity.C      648.       83.3      7.78 7.57e-15</span></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 clarity^4     -123.       66.7     -1.85 6.50e- 2</span></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 clarity^5      805.       54.6     14.7  4.91e-49</span></span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 7 clarity^6     -274.       47.7     -5.74 9.55e- 9</span></span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 8 clarity^7       81.2      42.0      1.93 5.33e- 2</span></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Trying to manually remove trends on the contrast in the data set doesn&#39;t work</span></span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>diamonds1 <span class="ot">&lt;-</span> diamonds</span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(diamonds1<span class="sc">$</span>clarity) <span class="ot">&lt;-</span> <span class="fu">contr.poly</span>(<span class="dv">8</span>)[,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]</span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(price <span class="sc">~</span> clarity, <span class="at">data =</span> diamonds1) <span class="sc">%&gt;%</span> </span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a>  broom<span class="sc">::</span><span class="fu">tidy</span>()</span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 8 x 5</span></span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   term        estimate std.error statistic  p.value</span></span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 (Intercept)   3677.       25.9    142.   0       </span></span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 clarity.L    -1723.       98.7    -17.5  4.70e-68</span></span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 clarity.Q     -428.       96.7     -4.43 9.45e- 6</span></span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 clarity.C      648.       83.3      7.78 7.57e-15</span></span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 clarity        594.       44.9     13.3  5.16e-40</span></span>
<span id="cb23-48"><a href="#cb23-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 clarity        566.       53.7     10.5  5.70e-26</span></span>
<span id="cb23-49"><a href="#cb23-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 7 clarity         76.3      68.5      1.11 2.65e- 1</span></span>
<span id="cb23-50"><a href="#cb23-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 8 clarity        255.       43.6      5.85 4.81e- 9</span></span>
<span id="cb23-51"><a href="#cb23-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-52"><a href="#cb23-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Decomposing the contrasts to create new columns for the first three trends</span></span>
<span id="cb23-53"><a href="#cb23-53" aria-hidden="true" tabindex="-1"></a><span class="co"># also works well (decompose_contrasts is still experimental)</span></span>
<span id="cb23-54"><a href="#cb23-54" aria-hidden="true" tabindex="-1"></a>diamonds2 <span class="ot">&lt;-</span> <span class="fu">decompose_contrasts</span>(diamonds, <span class="st">&quot;clarity&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb23-55"><a href="#cb23-55" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(price <span class="sc">~</span> clarity.L <span class="sc">+</span> clarity.Q <span class="sc">+</span> clarity.C, <span class="at">data =</span> diamonds2) <span class="sc">%&gt;%</span> </span>
<span id="cb23-56"><a href="#cb23-56" aria-hidden="true" tabindex="-1"></a>  broom<span class="sc">::</span><span class="fu">tidy</span>()</span>
<span id="cb23-57"><a href="#cb23-57" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 4 x 5</span></span>
<span id="cb23-58"><a href="#cb23-58" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   term        estimate std.error statistic   p.value</span></span>
<span id="cb23-59"><a href="#cb23-59" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span id="cb23-60"><a href="#cb23-60" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 (Intercept)   3796.       22.8   167.    0        </span></span>
<span id="cb23-61"><a href="#cb23-61" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 clarity.L    -2346.       85.7   -27.4   1.06e-163</span></span>
<span id="cb23-62"><a href="#cb23-62" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 clarity.Q      109.       71.9     1.52  1.29e-  1</span></span>
<span id="cb23-63"><a href="#cb23-63" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 clarity.C      -55.5      72.0    -0.770 4.41e-  1</span></span></code></pre></div>
<p>Note how when we tried to remove the trends on the factor column <code>diamonds1$clarity</code> it doesn’t work <em>and</em> it messes up the labels for the terms. This also means that you cannot drop trends with <code>set_contrasts</code>, and it will throw a warning that it will ignore that argument when it’s used:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Just show the messages, not the output</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">set_contrasts</span>(diamonds, clarity <span class="sc">~</span> contr.poly <span class="sc">-</span> <span class="dv">4</span><span class="sc">:</span><span class="dv">7</span>))</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in .reinstate_dropped_trends(formulas): Cannot drop trends with</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; set_contrasts, ignoring in 1 formula. Use enlist_contrasts instead.</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; These factors are ordered, you may lose contr.poly: clarity</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; You didn&#39;t set these factors, expect contr.treatment or contr.poly: cut color</span></span></code></pre></div>
</div>
<div id="glimpse-contrasts" class="section level1">
<h1>Glimpse Contrasts</h1>
<p>This is some newer functionality to gain some quick insight into the factors used in your dataset. It uses the same syntax as <code>enlist_contrasts</code> and <code>set_contrasts</code> and provides a dataframe with some useful information.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>tstdf <span class="ot">&lt;-</span> mtcars</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>tstdf<span class="sc">$</span>cyl <span class="ot">&lt;-</span> <span class="fu">factor</span>(tstdf<span class="sc">$</span>cyl)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>contrast_info <span class="ot">&lt;-</span> <span class="fu">glimpse_contrasts</span>(tstdf, </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>                                   vs <span class="sc">~</span> contr.treatment,</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>                                   am <span class="sc">~</span> scaled_sum_code <span class="sc">+</span> <span class="dv">1</span>,</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>                                   gear <span class="sc">~</span> helmert_code,</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>                                   carb <span class="sc">~</span> contr.poly,</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">all.factors =</span> <span class="cn">TRUE</span>)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Converting these to factors: vs am gear carb</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; You didn&#39;t set these factors, expect contr.treatment or contr.poly: cyl</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>contrast_info</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 x 9</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   factor n_levels level_names scheme          reference intercept  orthogonal</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;     &lt;int&gt; &lt;list&gt;      &lt;chr&gt;           &lt;chr&gt;     &lt;chr&gt;      &lt;lgl&gt;     </span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 vs            2 &lt;chr [2]&gt;   contr.treatment 0         mean(0)    TRUE      </span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 am            2 &lt;chr [2]&gt;   scaled_sum_code 1         grand mean TRUE      </span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 gear          3 &lt;chr [3]&gt;   helmert_code    5         grand mean TRUE      </span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 carb          6 &lt;chr [6]&gt;   contr.poly      &lt;NA&gt;      grand mean TRUE      </span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 cyl           3 &lt;chr [3]&gt;   contr.treatment 4         mean(4)    FALSE     </span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ... with 2 more variables: dropped_trends &lt;chr&gt;, explicitly_set &lt;lgl&gt;</span></span></code></pre></div>
<p>In this table we can easily reference what contrast scheme we used, what its reference level is when applicable, and how it may affect the interpretation of the intercept. Here, the intercept is to be interpreted as the average unit (whatever that is for your model) at level <code>0</code> of <code>vs</code> and level <code>4</code> of <code>cyl</code>, while it’s marginalized across the other predictors. Note that while helmert and reverse helmert schemes don’t have a reference level per se, the reference level shown in the table helps to show what the starting point is in case you forget which direction it’s going. Here, the levels are <code>3, 4, 5</code> and comparisons start at <code>5</code>, which means they’ll be going down: <code>4-5</code> then <code>3-(4,5)</code>.</p>
<p>We can also see if any are orthogonal or not and whether we explicitly set them or if R used the system defaults. Note that you shouldn’t call <code>glimpse_contrasts</code> on a dataframe you’ve already constructed with <code>set_contrasts</code>. You might think that using this would require you to copy and paste all the formulas twice, once to <code>enlist/set_contrasts</code> and again to <code>glimpse_contrasts</code>, but you can invoke <code>enlist_contrasts</code> from <code>glimpse_contrasts</code> using the <code>return.list</code> argument if you want to do it in one go. Doing so will return a list where the first item is the glimpse dataframe and the second is the list of named contrast matrices that can be passed to a model fitting function.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>contrast_info <span class="ot">&lt;-</span> <span class="fu">glimpse_contrasts</span>(tstdf, </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>                                   vs <span class="sc">~</span> contr.treatment,</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>                                   am <span class="sc">~</span> scaled_sum_code <span class="sc">+</span> <span class="dv">1</span>,</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>                                   gear <span class="sc">~</span> helmert_code,</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>                                   carb <span class="sc">~</span> contr.poly,</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">all.factors =</span> <span class="cn">TRUE</span>,</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">return.list =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Converting these to factors: vs am gear carb</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; You didn&#39;t set these factors, expect contr.treatment or contr.poly: cyl</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>my_contrasts <span class="ot">&lt;-</span> contrast_info<span class="sc">$</span>contrasts</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>contrast_glimpse <span class="ot">&lt;-</span> contrast_info<span class="sc">$</span>glimpse</span></code></pre></div>
<p>Alternatively, you can specify the contrast formulas in a list and save that to a variable, then pass that around to the different functions.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>schemes <span class="ot">&lt;-</span> <span class="fu">list</span>(vs <span class="sc">~</span> contr.treatment,</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>                am <span class="sc">~</span> scaled_sum_code <span class="sc">+</span> <span class="dv">1</span>,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>                gear <span class="sc">~</span> helmert_code,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>                carb <span class="sc">~</span> contr.poly)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>contrast_glimpse <span class="ot">&lt;-</span> <span class="fu">glimpse_contrasts</span>(tstdf, schemes)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Converting these to factors: vs am gear carb</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; You didn&#39;t set these factors, expect contr.treatment or contr.poly: cyl</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>contrast_glimpse <span class="co"># Review if needed</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 x 9</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   factor n_levels level_names scheme          reference intercept  orthogonal</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;     &lt;int&gt; &lt;list&gt;      &lt;chr&gt;           &lt;chr&gt;     &lt;chr&gt;      &lt;lgl&gt;     </span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 vs            2 &lt;chr [2]&gt;   contr.treatment 0         mean(0)    TRUE      </span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 am            2 &lt;chr [2]&gt;   scaled_sum_code 1         grand mean TRUE      </span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 gear          3 &lt;chr [3]&gt;   helmert_code    5         grand mean TRUE      </span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 carb          6 &lt;chr [6]&gt;   contr.poly      &lt;NA&gt;      grand mean TRUE      </span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 cyl           3 &lt;chr [3]&gt;   contr.treatment 4         mean(4)    FALSE     </span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ... with 2 more variables: dropped_trends &lt;chr&gt;, explicitly_set &lt;lgl&gt;</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>tstdf <span class="ot">&lt;-</span> <span class="fu">set_contrasts</span>(tstdf, schemes, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>We can also clean up the scheme names if we want to remove the “contr.” and “_code” parts.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>contrast_info <span class="ot">&lt;-</span> <span class="fu">glimpse_contrasts</span>(tstdf, schemes, <span class="at">clean.schemes =</span> <span class="cn">TRUE</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; You didn&#39;t set these factors, expect contr.treatment or contr.poly: cyl</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>contrast_info</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 x 9</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   factor n_levels level_names scheme          reference intercept  orthogonal</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;     &lt;int&gt; &lt;list&gt;      &lt;chr&gt;           &lt;chr&gt;     &lt;chr&gt;      &lt;lgl&gt;     </span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 vs            2 &lt;chr [2]&gt;   treatment       0         mean(0)    TRUE      </span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 am            2 &lt;chr [2]&gt;   scaled_sum      1         grand mean TRUE      </span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 gear          3 &lt;chr [3]&gt;   helmert         5         grand mean TRUE      </span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 carb          6 &lt;chr [6]&gt;   orth_polynomial &lt;NA&gt;      grand mean TRUE      </span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 cyl           3 &lt;chr [3]&gt;   treatment       4         mean(4)    FALSE     </span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ... with 2 more variables: dropped_trends &lt;chr&gt;, explicitly_set &lt;lgl&gt;</span></span></code></pre></div>
<p>Note that <code>contr.poly</code> will be changed to <code>orth_polynomial</code> when you do this to denote that you’re using <em>orthogonal</em> polynomials and not raw polynomials, since just <code>poly</code> could be confusing.</p>
</div>
<div id="conclusion" class="section level1">
<h1>Conclusion</h1>
<p>Hopefully this vignette highlighted some useful functionality available in this package. It does presuppose that you know a bit about what each scheme does. But, looking at the documentation for each function provides a bit of help about how to interpret fixed effects, eg <code>?scaled_sum_code</code>. The interpretation of interaction terms is more complicated and beyond the scope of this vignette, so choose your contrasts and models wisely!</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
