<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>contrasts</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">contrasts</h1>



<p>This vignette describes some of the contrast coding helpers this
package provides. It should be noted that this package does not seek to
provide an interface for creating hypothesis matrices and their
respective contrast matrices. For that functionality you might look into
the <code>multcomp</code> or <code>hypr</code> packages. The contrast
functionality of this package is focused on the following:</p>
<ul>
<li>Easily implement commonly used contrast coding schemes</li>
<li>Make reference levels explicit</li>
<li>Cut down on repetitive coding involved in setting contrasts</li>
<li>Retain interpretable labels in model summary coefficients</li>
<li>Allow the implementation of custom contrasts (but again not their
creation)</li>
</ul>
<p>This vignette will not go into detail how different contrast schemes
are derived or interpreted, but will describe some of the high level
differences. I recommend reading the following:</p>
<ul>
<li><a href="https://stats.oarc.ucla.edu/r/library/r-library-contrast-coding-systems-for-categorical-variables/">UCLA
R Library Contrast Coding Systems for Categorical Variables</a></li>
<li><a href="https://www.sciencedirect.com/science/article/pii/S0749596X19300695">How
to capitalize on a priori contrasts in linear (mixed) models: A
tutorial</a></li>
<li><a href="https://osf.io/pnumg/">Regresion modeling for linguistic
data (preprint)</a></li>
</ul>
<p>I also have a few blog posts about contrast coding; if you need
further explanation of contrasts and more working examples beyond this
vignette, read the first one below:</p>
<ul>
<li><a href="https://tsostaricsblog.netlify.app/posts/contrastable/">Introduction
to Contrasts using Contrastable</a></li>
<li><a href="On%20Helmert%20Coding">https://tsostaricsblog.netlify.app/posts/helmert/</a></li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(contrastable)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">library</span>(MASS)</span></code></pre></div>
<div id="introduction-to-contrasts" class="section level2">
<h2>Introduction to contrasts</h2>
<p>Statistical models such as linear regression need numbers to operate
with, but often we have discrete categories that we want to model such
as ethnicity, country, treatment group, etc. Typically, we have some
comparisons in mind before we do our statistics: compare the group
receiving treatment to a reference level who did not, or something like
compare group A to group B. <strong>Contrast coding</strong> is the
process of assigning numbers that encode the comparisons we want to make
prior to fitting a statistical model. What this allows us to do is
strategically set up our model to be interpretable in a way that’s
meaningful to us even though the <em>fit</em> of the statistical model
is unchanged. So, contrast coding is important for inferential
statistics and reporting coefficients correctly, but is not that
important for group-level predictions.</p>
<p>Throughout this vignette and package, I refer to different
<strong>contrast schemes</strong>, which I define as <em>an encoding of
a principled set of comparisons for an arbitrary number of factor
levels</em>. The important bit here is the <em>arbitrary</em> number
part.</p>
<p>To start with an example, consider an experiment where people are
tasked with keeping track of the location of different shapes under
different levels of cognitive load, such as needing to remember
different strings of numbers. Basically, a change detection task with a
digit span cognitive load manipulation. We’ll call the levels of this
<em>cognitive load</em> factor none, low, and high. A priori, the speed
with which people detect a shape that changes location should vary
depending on the cognitive load. Specifically, reaction time (RT) should
be slower when cognitive load is higher.</p>
<p>What kinds of comparisons could we make, and how do we encode these
in our statistical model? One comparison might be to compare low to
none, then high to none. Another could be to compare low to none, then
high to <em>low</em>. Yet another could be to compare low to none, then
high to <em>low and none</em> together. Or, we could compare each level
to the average across the conditions.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> Specifying these different comparisons,
which will really just amount to differences in group means, is our goal
here.</p>
<p>In our example, what if we went found that our high cognitive load
condition wasn’t high enough? What if we needed to add an extra-high
level? We could add a comparison of extra-high to none, or compare
extra-high to high. Or, we could compare extra-high to none plus low
plus high together. Ideally, if we’re going for pairwise comparisons
from a reference level, successive differences between levels, or some
kind of nested set of comparisons, we would want to be able to specify
this consistently without needing to revisit every instance of
specifying our comparisons just to accommodate the new level.</p>
<p>Throughout this vignette and package, I refer to different
<strong>contrast schemes</strong>, which I define as <em>an encoding of
a principled set of comparisons for an arbitrary number of factor
levels</em>. The important bit here is the <em>arbitrary</em> number
part such that if the goal is to take pairwise comparisons from a
reference level, then adding a new level should only amount to encoding
an additional pairwise comparison to the same reference level. I’ll
contrast this approach to a more manual approach to contrast coding,
where you would explicitly write out, in code, every single comparison
for every single factor you want to make. Consider if we added a new
three-level predictor crossed with our four level example from before
(we’ll call the new predictor <em>group</em> with levels A, B, C). If we
also just wanted to do pairwise comparisons, a scheme approach would
encode <em>pairwise comparisons</em> for cognitive load and <em>pairwise
comparisons</em> for the new factor. The manual approach would say to
encode low-none, high-none, and extra high-none; then, encode B-A, and
C-A. If we introduce a new group D later, we have to remember to go in
and specify D-A too.</p>
<p>So, while the manual approach is maximally explicit about exactly
what we want to compare, it’s also more things to write out and more
chances that we make a mistake while implementing it. Given that
contrasts are specified using matrices in R, the chances of a mistake
are high. Accordingly, R provides a few functions that implement common
contrast schemes such as <code>contr.treatment</code> and
<code>contr.sum</code>, which return matrices given a number of levels.
However, there’s some trickiness with them. Below is a quick list of
some issues this package attempts to circumvent; if you’re familiar with
contrast coding from your own work, some of this may sound familiar and
some of it may surprise you.</p>
<ul>
<li>When setting contrasts to a factor that differ from the R session’s
default contrasts, the labels for the comparisons in the output of the
statistical model are reset. This requires the researcher to keep track
of which numeric indices (1, 2, etc.) correspond to which
comparisons—which also requires keeping track of the alphabetical order
of the levels. Alternatively, the researcher can set the comparison
labels using <code>dim()</code>, <code>dimnames()</code>, or
<code>colnames()</code>. In my experience, I rarely see people in my
field do this, and so I believe it would be naive to expect people to
suddenly (learn how to and) start doing so.</li>
<li>The default contrast scheme, <code>contr.treatment</code>, places
the reference level as the first level alphabetically while
<code>contr.sum</code> places the reference level as the LAST level
alphabetically. To verify for yourself, try running
<code>contr.treatment(5)</code> and <code>contr.sum(5)</code>.
respectively, the reference levels are identifiable by the rows
containing either all 0s or all -1s.</li>
<li>Related to the above, when people want to use <span class="math inline">\(\pm.5\)</span> for their contrasts for a two-level
factor, it is not uncommon to see something like
<code>-contr.sum(2)/2</code>. However, this <strong><em>does not
generalize</em></strong> when the number of levels is greater than 2,
i.e,. <code>-contr.sum(3)/2</code> will not give you what you
expect.</li>
<li><code>contr.helmert</code> returns unscaled matrices, giving effect
estimates that need to be manually scaled. Tests of statistical
significance are still meaningful, but interpreting the magnitude of
effects using matrices from this function are likely to be incorrect if
not scaled manually.</li>
<li>Quite a few contrasts simplify to <span class="math inline">\(\pm.5\)</span> when there are two levels. For
example, helmert coding and backward difference coding both give +.5 and
-.5. But, if we were to add a third level to these, the values for the
newly added comparison are NOT the same. Accordingly, if we’re not
explicit about what the <strong>goal</strong> of the comparisons are
(nested comparisons vs successive comparisons) then future researchers
following up on our work might attempt to use the same contrast scheme
but not understand what the new comparison is.</li>
</ul>
</div>
<div id="motivation" class="section level2">
<h2>Motivation</h2>
<p>I’m going to use the mtcars dataset just to have something to work
with. We’ll convert a bunch of the columns to factors up front.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>mdl_data <span class="ot">&lt;-</span> </span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>  mtcars <span class="sc">|&gt;</span> </span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span> </span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cyl =</span> <span class="fu">factor</span>(cyl), </span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>         <span class="at">twolevel =</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>), <span class="at">times =</span> <span class="fu">nrow</span>(mtcars) <span class="sc">/</span> <span class="dv">2</span>)),</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>         <span class="at">gear =</span> <span class="fu">factor</span>(gear),</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>         <span class="at">carb =</span> <span class="fu">factor</span>(carb))</span></code></pre></div>
<p>We can inspect the contrasts for the factors using
<code>contrasts()</code>, which will use the default contrasts for
unordered factors</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">options</span>(<span class="st">&quot;contrasts&quot;</span>) <span class="co"># Show defaults for unordered and ordered</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="co">#&gt; $contrasts</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="co">#&gt;         unordered           ordered </span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="co">#&gt; &quot;contr.treatment&quot;      &quot;contr.poly&quot;</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="fu">contrasts</span>(mdl_data<span class="sc">$</span>twolevel)</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="co">#&gt;   b</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="co">#&gt; a 0</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="co">#&gt; b 1</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a><span class="fu">contrasts</span>(mdl_data<span class="sc">$</span>carb) <span class="co"># Note the reference level</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="co">#&gt;   2 3 4 6 8</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="co">#&gt; 1 0 0 0 0 0</span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a><span class="co">#&gt; 2 1 0 0 0 0</span></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a><span class="co">#&gt; 3 0 1 0 0 0</span></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a><span class="co">#&gt; 4 0 0 1 0 0</span></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a><span class="co">#&gt; 6 0 0 0 1 0</span></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a><span class="co">#&gt; 8 0 0 0 0 1</span></span></code></pre></div>
<p>We can see that the levels for <code>carb</code> are reflected in the
coefficient labels:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(mpg <span class="sc">~</span> carb, <span class="at">data =</span> mdl_data))</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="co">#&gt; Call:</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="co">#&gt; lm(formula = mpg ~ carb, data = mdl_data)</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="co">#&gt; Residuals:</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="co">#&gt;    Min     1Q Median     3Q    Max </span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="co">#&gt; -7.243 -3.325  0.000  2.360  8.557 </span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="co">#&gt; Coefficients:</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a><span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a><span class="co">#&gt; (Intercept)   25.343      1.854  13.670 2.21e-13 ***</span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a><span class="co">#&gt; carb2         -2.943      2.417  -1.218  0.23435    </span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a><span class="co">#&gt; carb3         -9.043      3.385  -2.672  0.01285 *  </span></span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a><span class="co">#&gt; carb4         -9.553      2.417  -3.952  0.00053 ***</span></span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a><span class="co">#&gt; carb6         -5.643      5.243  -1.076  0.29174    </span></span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a><span class="co">#&gt; carb8        -10.343      5.243  -1.973  0.05927 .  </span></span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a><span class="co">#&gt; ---</span></span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a><span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a><span class="co">#&gt; Residual standard error: 4.905 on 26 degrees of freedom</span></span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a><span class="co">#&gt; Multiple R-squared:  0.4445, Adjusted R-squared:  0.3377 </span></span>
<span id="cb4-23"><a href="#cb4-23" tabindex="-1"></a><span class="co">#&gt; F-statistic: 4.161 on 5 and 26 DF,  p-value: 0.006546</span></span></code></pre></div>
<p>But if we changed the contrasts ourselves those helpful labels go
away and are replaced with numeric indices. Note that the level names
were originally also numbers, so it would be easy to get mixed up at
this point.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>mdl_data2 <span class="ot">&lt;-</span> mdl_data</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="fu">contrasts</span>(mdl_data2<span class="sc">$</span>carb) <span class="ot">&lt;-</span> <span class="fu">contr.sum</span>(<span class="dv">6</span>)</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="fu">contrasts</span>(mdl_data2<span class="sc">$</span>carb) <span class="co"># Note the reference level</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="co">#&gt;   [,1] [,2] [,3] [,4] [,5]</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a><span class="co">#&gt; 1    1    0    0    0    0</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="co">#&gt; 2    0    1    0    0    0</span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="co">#&gt; 3    0    0    1    0    0</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a><span class="co">#&gt; 4    0    0    0    1    0</span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a><span class="co">#&gt; 6    0    0    0    0    1</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a><span class="co">#&gt; 8   -1   -1   -1   -1   -1</span></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(mpg <span class="sc">~</span> carb, <span class="at">data =</span> mdl_data2))</span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a><span class="co">#&gt; Call:</span></span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a><span class="co">#&gt; lm(formula = mpg ~ carb, data = mdl_data2)</span></span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a><span class="co">#&gt; Residuals:</span></span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a><span class="co">#&gt;    Min     1Q Median     3Q    Max </span></span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a><span class="co">#&gt; -7.243 -3.325  0.000  2.360  8.557 </span></span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a><span class="co">#&gt; Coefficients:</span></span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a><span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span id="cb5-23"><a href="#cb5-23" tabindex="-1"></a><span class="co">#&gt; (Intercept)  19.0888     1.3373  14.274 8.18e-14 ***</span></span>
<span id="cb5-24"><a href="#cb5-24" tabindex="-1"></a><span class="co">#&gt; carb1         6.2540     2.0198   3.096  0.00465 ** </span></span>
<span id="cb5-25"><a href="#cb5-25" tabindex="-1"></a><span class="co">#&gt; carb2         3.3112     1.8418   1.798  0.08383 .  </span></span>
<span id="cb5-26"><a href="#cb5-26" tabindex="-1"></a><span class="co">#&gt; carb3        -2.7888     2.6710  -1.044  0.30605    </span></span>
<span id="cb5-27"><a href="#cb5-27" tabindex="-1"></a><span class="co">#&gt; carb4        -3.2988     1.8418  -1.791  0.08493 .  </span></span>
<span id="cb5-28"><a href="#cb5-28" tabindex="-1"></a><span class="co">#&gt; carb5         0.6112     4.2221   0.145  0.88602    </span></span>
<span id="cb5-29"><a href="#cb5-29" tabindex="-1"></a><span class="co">#&gt; ---</span></span>
<span id="cb5-30"><a href="#cb5-30" tabindex="-1"></a><span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb5-31"><a href="#cb5-31" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-32"><a href="#cb5-32" tabindex="-1"></a><span class="co">#&gt; Residual standard error: 4.905 on 26 degrees of freedom</span></span>
<span id="cb5-33"><a href="#cb5-33" tabindex="-1"></a><span class="co">#&gt; Multiple R-squared:  0.4445, Adjusted R-squared:  0.3377 </span></span>
<span id="cb5-34"><a href="#cb5-34" tabindex="-1"></a><span class="co">#&gt; F-statistic: 4.161 on 5 and 26 DF,  p-value: 0.006546</span></span></code></pre></div>
</div>
<div id="usage" class="section level2">
<h2>Usage</h2>
<p>Now I’ll introduce the main workhorse of this package: the
<code>set_contrasts</code> function. This function features a special
syntax to quickly set contrast schemes. I’ll introduce features one at a
time.</p>
<p>First, we’ll set <code>carb</code> to use sum coding as we did
before. We do this using two-sided formulas, where the left hand side of
the formula is a column in our dataset and the right hand side includes
information about the contrasts we want to set. For example, this takes
the form <code>varname ~ code_by</code>. Below, we specify that we want
<code>carb</code> to use contrasts generated by the
<code>sum_code</code> function. Two things to note:
<code>set_contrasts</code> will <strong><em>automatically</em></strong>
coerce specified columns into factors, so you don’t need to worry about
calling <code>factor()</code> on columns first. Note that the function
will also give messages about other factors that you haven’t set
explicitly.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>mdl_data3 <span class="ot">&lt;-</span> <span class="fu">set_contrasts</span>(mdl_data, carb <span class="sc">~</span> sum_code)</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="co">#&gt; Expect contr.treatment or contr.poly for unset factors: cyl gear twolevel</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="fu">contrasts</span>(mdl_data2<span class="sc">$</span>carb) <span class="co"># matrix from before</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="co">#&gt;   [,1] [,2] [,3] [,4] [,5]</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="co">#&gt; 1    1    0    0    0    0</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="co">#&gt; 2    0    1    0    0    0</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="co">#&gt; 3    0    0    1    0    0</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="co">#&gt; 4    0    0    0    1    0</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="co">#&gt; 6    0    0    0    0    1</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a><span class="co">#&gt; 8   -1   -1   -1   -1   -1</span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a><span class="fu">contrasts</span>(mdl_data3<span class="sc">$</span>carb) <span class="co"># new matrix, note the column names</span></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="co">#&gt;    2  3  4  6  8</span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a><span class="co">#&gt; 1 -1 -1 -1 -1 -1</span></span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a><span class="co">#&gt; 2  1  0  0  0  0</span></span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a><span class="co">#&gt; 3  0  1  0  0  0</span></span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a><span class="co">#&gt; 4  0  0  1  0  0</span></span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a><span class="co">#&gt; 6  0  0  0  1  0</span></span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a><span class="co">#&gt; 8  0  0  0  0  1</span></span></code></pre></div>
<p>Note that, unlike last time, the reference level is now the first
level alphabetically and the labels are retained (compare the contrast
matrices) For schemes that have a singular reference level, setting
contrasts with <code>set_contrasts</code> will always set the reference
level to the first level alphabetically. Currently, the reference level
for <code>carb</code> is <code>1</code>. If we want to change the
reference level, we use the <code>+</code> operator in our formula. The
change to the formula looks like
<code>varname ~ code_by + reference</code>. Let’s change it to
<code>3</code>:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>mdl_data4 <span class="ot">&lt;-</span> <span class="fu">set_contrasts</span>(mdl_data, carb <span class="sc">~</span> sum_code <span class="sc">+</span> <span class="st">&quot;3&quot;</span>)  </span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="co">#&gt; Expect contr.treatment or contr.poly for unset factors: cyl gear twolevel</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="fu">contrasts</span>(mdl_data4<span class="sc">$</span>carb)</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="co">#&gt;    1  2  4  6  8</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="co">#&gt; 1  1  0  0  0  0</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a><span class="co">#&gt; 2  0  1  0  0  0</span></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a><span class="co">#&gt; 3 -1 -1 -1 -1 -1</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a><span class="co">#&gt; 4  0  0  1  0  0</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a><span class="co">#&gt; 6  0  0  0  1  0</span></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a><span class="co">#&gt; 8  0  0  0  0  1</span></span></code></pre></div>
<p>Note that when using sum coding, the intercept will be the mean of
the group means:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="co"># mean of group means:</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>group_means <span class="ot">&lt;-</span> <span class="fu">summarize</span>(mdl_data4, <span class="at">grp_mean =</span> <span class="fu">mean</span>(mpg), <span class="at">.by =</span> <span class="st">&quot;carb&quot;</span>)</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>group_means</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 × 2</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="co">#&gt;   carb  grp_mean</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="co">#&gt;   &lt;fct&gt;    &lt;dbl&gt;</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="co">#&gt; 1 4         15.8</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="co">#&gt; 2 1         25.3</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="co">#&gt; 3 2         22.4</span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="co">#&gt; 4 3         16.3</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a><span class="co">#&gt; 5 6         19.7</span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a><span class="co">#&gt; 6 8         15</span></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a><span class="fu">mean</span>(group_means<span class="sc">$</span>grp_mean)</span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a><span class="co">#&gt; [1] 19.08881</span></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a><span class="co"># model coefficients</span></span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a><span class="fu">coef</span>(<span class="fu">lm</span>(mpg <span class="sc">~</span> carb, <span class="at">data =</span> mdl_data4))</span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a><span class="co">#&gt; (Intercept)       carb1       carb2       carb4       carb6       carb8 </span></span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a><span class="co">#&gt;  19.0888095   6.2540476   3.3111905  -3.2988095   0.6111905  -4.0888095</span></span></code></pre></div>
<p>Let’s say, hypothetically, we wanted to get differences of each
comparison level to the grand mean, but we also wanted the intercept to
be not the grand mean but the mean of our reference level? We can set
this using the <code>*</code> operator:
<code>varname ~ code_by + reference * intercept</code>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>mdl_data5 <span class="ot">&lt;-</span> <span class="fu">set_contrasts</span>(mdl_data, carb <span class="sc">~</span> sum_code <span class="sc">+</span> <span class="dv">3</span> <span class="sc">*</span> <span class="dv">3</span>)</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="co">#&gt; Expect contr.treatment or contr.poly for unset factors: cyl gear twolevel</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="fu">contrasts</span>(mdl_data5<span class="sc">$</span>carb)</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="co">#&gt;   1 2 4 6 8</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="co">#&gt; 1 2 1 1 1 1</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="co">#&gt; 2 1 2 1 1 1</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a><span class="co">#&gt; 3 0 0 0 0 0</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="co">#&gt; 4 1 1 2 1 1</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a><span class="co">#&gt; 6 1 1 1 2 1</span></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a><span class="co">#&gt; 8 1 1 1 1 2</span></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a><span class="fu">coef</span>(<span class="fu">lm</span>(mpg <span class="sc">~</span> carb, <span class="at">data =</span> mdl_data5))</span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a><span class="co">#&gt; (Intercept)       carb1       carb2       carb4       carb6       carb8 </span></span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a><span class="co">#&gt;  16.3000000   6.2540476   3.3111905  -3.2988095   0.6111905  -4.0888095</span></span></code></pre></div>
<p>Finally, let’s say we wanted labels that were a bit more clear about
what the comparisons are here. We can set the label names ourselves
using the <code>|</code> operator:
<code>varname ~ code_by + reference * intercept | labels</code></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>mdl_data6 <span class="ot">&lt;-</span> <span class="fu">set_contrasts</span>(mdl_data, </span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>                           carb <span class="sc">~</span> sum_code <span class="sc">+</span> <span class="dv">3</span> <span class="sc">*</span> <span class="dv">3</span> <span class="sc">|</span> <span class="fu">c</span>(<span class="st">&quot;1-3&quot;</span>,</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>                                                       <span class="st">&quot;2-3&quot;</span>,</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>                                                       <span class="st">&quot;4-3&quot;</span>,</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>                                                       <span class="st">&quot;6-3&quot;</span>,</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>                                                       <span class="st">&quot;8-3&quot;</span>))</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="co">#&gt; Expect contr.treatment or contr.poly for unset factors: cyl gear twolevel</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a><span class="fu">contrasts</span>(mdl_data5<span class="sc">$</span>carb)</span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a><span class="co">#&gt;   1 2 4 6 8</span></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a><span class="co">#&gt; 1 2 1 1 1 1</span></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a><span class="co">#&gt; 2 1 2 1 1 1</span></span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a><span class="co">#&gt; 3 0 0 0 0 0</span></span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a><span class="co">#&gt; 4 1 1 2 1 1</span></span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a><span class="co">#&gt; 6 1 1 1 2 1</span></span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a><span class="co">#&gt; 8 1 1 1 1 2</span></span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a><span class="fu">coef</span>(<span class="fu">lm</span>(mpg <span class="sc">~</span> carb, <span class="at">data =</span> mdl_data6))</span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a><span class="co">#&gt; (Intercept)     carb1-3     carb2-3     carb4-3     carb6-3     carb8-3 </span></span>
<span id="cb10-19"><a href="#cb10-19" tabindex="-1"></a><span class="co">#&gt;  16.3000000   6.2540476   3.3111905  -3.2988095   0.6111905  -4.0888095</span></span></code></pre></div>
<p>Here’s what it would look like if you tried to manually do this
yourself. It’s highly unlikely you would correctly specify every single
value and every single label correctly on the first go (I actually
messed up myself while writing out the matrix).</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>mdl_data7 <span class="ot">&lt;-</span> mdl_data</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>my_contrasts <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, </span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>                         <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, </span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>                         <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, </span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>                         <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>,</span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>                         <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a>                       <span class="at">nrow =</span> <span class="dv">6</span>)</span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a><span class="fu">dimnames</span>(my_contrasts) <span class="ot">&lt;-</span> </span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;3&quot;</span>, <span class="st">&quot;4&quot;</span>, <span class="st">&quot;6&quot;</span>, <span class="st">&quot;8&quot;</span>), </span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">&quot;1-3&quot;</span>, <span class="st">&quot;2-3&quot;</span>, <span class="st">&quot;4-3&quot;</span>, <span class="st">&quot;6-3&quot;</span>, <span class="st">&quot;8-3&quot;</span>)</span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a>  )</span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a></span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a><span class="fu">contrasts</span>(mdl_data7<span class="sc">$</span>carb) <span class="ot">&lt;-</span> my_contrasts</span>
<span id="cb11-17"><a href="#cb11-17" tabindex="-1"></a><span class="fu">contrasts</span>(mdl_data7<span class="sc">$</span>carb)</span>
<span id="cb11-18"><a href="#cb11-18" tabindex="-1"></a><span class="co">#&gt;   1-3 2-3 4-3 6-3 8-3</span></span>
<span id="cb11-19"><a href="#cb11-19" tabindex="-1"></a><span class="co">#&gt; 1   2   1   1   1   1</span></span>
<span id="cb11-20"><a href="#cb11-20" tabindex="-1"></a><span class="co">#&gt; 2   1   2   1   1   1</span></span>
<span id="cb11-21"><a href="#cb11-21" tabindex="-1"></a><span class="co">#&gt; 3   0   0   0   0   0</span></span>
<span id="cb11-22"><a href="#cb11-22" tabindex="-1"></a><span class="co">#&gt; 4   1   1   2   1   1</span></span>
<span id="cb11-23"><a href="#cb11-23" tabindex="-1"></a><span class="co">#&gt; 6   1   1   1   2   1</span></span>
<span id="cb11-24"><a href="#cb11-24" tabindex="-1"></a><span class="co">#&gt; 8   1   1   1   1   2</span></span></code></pre></div>
<p>To see how this can get even more error prone, consider a contrast
matrix like the one below. Personally I would not trust myself to get
the matrix correct, and if I ever had to add a level to the design it
would be obscene to try and edit it.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>mdl_data8 <span class="ot">&lt;-</span> <span class="fu">set_contrasts</span>(mdl_data, carb <span class="sc">~</span> helmert_code <span class="sc">*</span> <span class="dv">4</span>)</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="co">#&gt; Expect contr.treatment or contr.poly for unset factors: cyl gear twolevel</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>MASS<span class="sc">::</span><span class="fu">fractions</span>(<span class="fu">contrasts</span>(mdl_data8<span class="sc">$</span>carb))</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="co">#&gt;   &lt;2   &lt;3   &lt;4   &lt;6   &lt;8  </span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a><span class="co">#&gt; 1 -1/2 -1/3   -1    0    0</span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="co">#&gt; 2  1/2 -1/3   -1    0    0</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a><span class="co">#&gt; 3    0  2/3   -1    0    0</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a><span class="co">#&gt; 4    0    0    0    0    0</span></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a><span class="co">#&gt; 6    0    0 -3/4    1    0</span></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a><span class="co">#&gt; 8    0    0 -3/4  1/5    1</span></span></code></pre></div>
<p>The work would compound when we have multiple factors, but with the
<code>set_contrasts</code> function we can specify what our desired
scheme is easily:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>mdl_data9 <span class="ot">&lt;-</span> <span class="fu">set_contrasts</span>(mdl_data,</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>                           carb <span class="sc">~</span> helmert_code <span class="sc">*</span> <span class="dv">4</span>,</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>                           cyl <span class="sc">~</span> scaled_sum_code <span class="sc">+</span> <span class="dv">4</span>,</span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>                           twolevel <span class="sc">~</span> scaled_sum_code <span class="sc">+</span> <span class="st">&quot;a&quot;</span>,</span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>                           gear <span class="sc">~</span> helmert_code)</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a>MASS<span class="sc">::</span><span class="fu">fractions</span>(<span class="fu">contrasts</span>(mdl_data9<span class="sc">$</span>carb))</span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a><span class="co">#&gt;   &lt;2   &lt;3   &lt;4   &lt;6   &lt;8  </span></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a><span class="co">#&gt; 1 -1/2 -1/3   -1    0    0</span></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a><span class="co">#&gt; 2  1/2 -1/3   -1    0    0</span></span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a><span class="co">#&gt; 3    0  2/3   -1    0    0</span></span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a><span class="co">#&gt; 4    0    0    0    0    0</span></span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a><span class="co">#&gt; 6    0    0 -3/4    1    0</span></span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a><span class="co">#&gt; 8    0    0 -3/4  1/5    1</span></span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a>MASS<span class="sc">::</span><span class="fu">fractions</span>(<span class="fu">contrasts</span>(mdl_data9<span class="sc">$</span>cyl))</span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a><span class="co">#&gt;   6    8   </span></span>
<span id="cb13-17"><a href="#cb13-17" tabindex="-1"></a><span class="co">#&gt; 4 -1/3 -1/3</span></span>
<span id="cb13-18"><a href="#cb13-18" tabindex="-1"></a><span class="co">#&gt; 6  2/3 -1/3</span></span>
<span id="cb13-19"><a href="#cb13-19" tabindex="-1"></a><span class="co">#&gt; 8 -1/3  2/3</span></span>
<span id="cb13-20"><a href="#cb13-20" tabindex="-1"></a>MASS<span class="sc">::</span><span class="fu">fractions</span>(<span class="fu">contrasts</span>(mdl_data9<span class="sc">$</span>twolevel))</span>
<span id="cb13-21"><a href="#cb13-21" tabindex="-1"></a><span class="co">#&gt;   b   </span></span>
<span id="cb13-22"><a href="#cb13-22" tabindex="-1"></a><span class="co">#&gt; a -1/2</span></span>
<span id="cb13-23"><a href="#cb13-23" tabindex="-1"></a><span class="co">#&gt; b  1/2</span></span>
<span id="cb13-24"><a href="#cb13-24" tabindex="-1"></a>MASS<span class="sc">::</span><span class="fu">fractions</span>(<span class="fu">contrasts</span>(mdl_data9<span class="sc">$</span>gear))</span>
<span id="cb13-25"><a href="#cb13-25" tabindex="-1"></a><span class="co">#&gt;   &lt;4   &lt;5  </span></span>
<span id="cb13-26"><a href="#cb13-26" tabindex="-1"></a><span class="co">#&gt; 3 -1/2 -1/3</span></span>
<span id="cb13-27"><a href="#cb13-27" tabindex="-1"></a><span class="co">#&gt; 4  1/2 -1/3</span></span>
<span id="cb13-28"><a href="#cb13-28" tabindex="-1"></a><span class="co">#&gt; 5    0  2/3</span></span></code></pre></div>
<p>Practically speaking, the most common things you’ll be doing is
setting a contrast scheme and maybe changing the reference level, so the
<code>+</code> operator is very important.</p>
<div id="enlist_contrasts" class="section level3">
<h3>enlist_contrasts</h3>
<p>A related function is the <code>enlist_contrasts</code> function,
which follows the same exact rules as <code>set_contrasts</code> but
will return a list of contrasts instead of setting the contrasts to the
data itself. Henceforth, when I’m not going to use the dataframe in an
example, I’ll just use this to show the contrast matrices.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="fu">enlist_contrasts</span>(mdl_data,</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>                 carb <span class="sc">~</span> helmert_code <span class="sc">*</span> <span class="dv">4</span>,</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>                 cyl <span class="sc">~</span> scaled_sum_code <span class="sc">+</span> <span class="dv">4</span>)</span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="co">#&gt; Expect contr.treatment or contr.poly for unset factors: gear twolevel</span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a><span class="co">#&gt; $carb</span></span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a><span class="co">#&gt;     &lt;2         &lt;3    &lt;4  &lt;6 &lt;8</span></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a><span class="co">#&gt; 1 -0.5 -0.3333333 -1.00 0.0  0</span></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a><span class="co">#&gt; 2  0.5 -0.3333333 -1.00 0.0  0</span></span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a><span class="co">#&gt; 3  0.0  0.6666667 -1.00 0.0  0</span></span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a><span class="co">#&gt; 4  0.0  0.0000000  0.00 0.0  0</span></span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a><span class="co">#&gt; 6  0.0  0.0000000 -0.75 1.0  0</span></span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a><span class="co">#&gt; 8  0.0  0.0000000 -0.75 0.2  1</span></span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a><span class="co">#&gt; $cyl</span></span>
<span id="cb14-15"><a href="#cb14-15" tabindex="-1"></a><span class="co">#&gt;            6          8</span></span>
<span id="cb14-16"><a href="#cb14-16" tabindex="-1"></a><span class="co">#&gt; 4 -0.3333333 -0.3333333</span></span>
<span id="cb14-17"><a href="#cb14-17" tabindex="-1"></a><span class="co">#&gt; 6  0.6666667 -0.3333333</span></span>
<span id="cb14-18"><a href="#cb14-18" tabindex="-1"></a><span class="co">#&gt; 8 -0.3333333  0.6666667</span></span></code></pre></div>
</div>
<div id="contrast-functions" class="section level3">
<h3>Contrast functions</h3>
<p>I showed a few functions that generate contrasts like
<code>sum_code</code> and <code>scaled_sum_code</code> and
<code>helmert_code</code>. Below is a list of functions provided by this
package:</p>
<ul>
<li><code>treatment_code</code>: Pairwise comparisons to a reference
level, intercept equals the reference level (equivalent to
<code>contr.treatment</code>)</li>
<li><code>sum_code</code>: Comparisons to the grand mean, intercept is
the grand mean (equivalent to <code>contr.sum</code>, but reference
level is the first level)</li>
<li><code>scaled_sum_code</code>: Pairwise comparisons to a reference
level, intercept equals the grand mean</li>
<li><code>helmert_code</code>: Nested comparisons starting from the
first level. Note this is NOT equivalent to <code>contr.helmert</code>,
as the latter gives an unscaled matrix.</li>
<li><code>reverse_helmert_code</code>: Nested comparisons starting from
the last level.</li>
<li><code>backward_difference_code</code>: Successive differences. For
levels A, B, C, gives the differences B-A and C-B</li>
<li><code>forward_difference_code</code>: Successive differences. For
levels A, B, C, gives the differences A-B and B-C.</li>
<li><code>cumulative_split_code</code>: Dichotomous differences. For
levels A, B, C, D, gives the differences A-(B+C+D), (A+B)-(C+D),
(A+B+C)-D.</li>
<li><code>orth_polynomial_code</code>: Orthogonal polynomial coding,
equivalent to <code>contr.poly</code>.</li>
<li><code>raw_polynomial_code</code>: Raw polynomial coding, I do not
recommend using this unless you know what you’re getting into.</li>
<li><code>polynomial_code</code>: An alias for
<code>orthogonal_polynomial_code</code></li>
</ul>
<p>You can also use contrast functions from any other package so long as
the first argument is the number of levels used to generate the matrix.
However, again, if there’s a singular level used for the reference
level, this will always be set to the first level regardless of what the
original matrix was.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="co"># all equivalent to carb ~ sum_code</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>foo <span class="ot">&lt;-</span> sum_code</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="fu">enlist_contrasts</span>(mdl_data, carb <span class="sc">~</span> contr.sum)</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="co">#&gt; Expect contr.treatment or contr.poly for unset factors: cyl gear twolevel</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a><span class="co">#&gt; $carb</span></span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a><span class="co">#&gt;    2  3  4  6  8</span></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a><span class="co">#&gt; 1 -1 -1 -1 -1 -1</span></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a><span class="co">#&gt; 2  1  0  0  0  0</span></span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a><span class="co">#&gt; 3  0  1  0  0  0</span></span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a><span class="co">#&gt; 4  0  0  1  0  0</span></span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a><span class="co">#&gt; 6  0  0  0  1  0</span></span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a><span class="co">#&gt; 8  0  0  0  0  1</span></span>
<span id="cb15-13"><a href="#cb15-13" tabindex="-1"></a><span class="fu">enlist_contrasts</span>(mdl_data, carb <span class="sc">~</span> sum_code)</span>
<span id="cb15-14"><a href="#cb15-14" tabindex="-1"></a><span class="co">#&gt; Expect contr.treatment or contr.poly for unset factors: cyl gear twolevel</span></span>
<span id="cb15-15"><a href="#cb15-15" tabindex="-1"></a><span class="co">#&gt; $carb</span></span>
<span id="cb15-16"><a href="#cb15-16" tabindex="-1"></a><span class="co">#&gt;    2  3  4  6  8</span></span>
<span id="cb15-17"><a href="#cb15-17" tabindex="-1"></a><span class="co">#&gt; 1 -1 -1 -1 -1 -1</span></span>
<span id="cb15-18"><a href="#cb15-18" tabindex="-1"></a><span class="co">#&gt; 2  1  0  0  0  0</span></span>
<span id="cb15-19"><a href="#cb15-19" tabindex="-1"></a><span class="co">#&gt; 3  0  1  0  0  0</span></span>
<span id="cb15-20"><a href="#cb15-20" tabindex="-1"></a><span class="co">#&gt; 4  0  0  1  0  0</span></span>
<span id="cb15-21"><a href="#cb15-21" tabindex="-1"></a><span class="co">#&gt; 6  0  0  0  1  0</span></span>
<span id="cb15-22"><a href="#cb15-22" tabindex="-1"></a><span class="co">#&gt; 8  0  0  0  0  1</span></span>
<span id="cb15-23"><a href="#cb15-23" tabindex="-1"></a><span class="fu">enlist_contrasts</span>(mdl_data, carb <span class="sc">~</span> foo)</span>
<span id="cb15-24"><a href="#cb15-24" tabindex="-1"></a><span class="co">#&gt; Expect contr.treatment or contr.poly for unset factors: cyl gear twolevel</span></span>
<span id="cb15-25"><a href="#cb15-25" tabindex="-1"></a><span class="co">#&gt; $carb</span></span>
<span id="cb15-26"><a href="#cb15-26" tabindex="-1"></a><span class="co">#&gt;    2  3  4  6  8</span></span>
<span id="cb15-27"><a href="#cb15-27" tabindex="-1"></a><span class="co">#&gt; 1 -1 -1 -1 -1 -1</span></span>
<span id="cb15-28"><a href="#cb15-28" tabindex="-1"></a><span class="co">#&gt; 2  1  0  0  0  0</span></span>
<span id="cb15-29"><a href="#cb15-29" tabindex="-1"></a><span class="co">#&gt; 3  0  1  0  0  0</span></span>
<span id="cb15-30"><a href="#cb15-30" tabindex="-1"></a><span class="co">#&gt; 4  0  0  1  0  0</span></span>
<span id="cb15-31"><a href="#cb15-31" tabindex="-1"></a><span class="co">#&gt; 6  0  0  0  1  0</span></span>
<span id="cb15-32"><a href="#cb15-32" tabindex="-1"></a><span class="co">#&gt; 8  0  0  0  0  1</span></span></code></pre></div>
<p>If you want to suppress this behavior, you can use the wrapper
<code>I</code> from base R. Note this will also result in not setting
the labels for you: it will use the generated matrix as-is. This is
useful if you explicitly create a matrix and want to make sure the
reference level isn’t shifted around.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="fu">enlist_contrasts</span>(mdl_data, carb <span class="sc">~</span> <span class="fu">I</span>(contr.sum))</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a><span class="co">#&gt; Expect contr.treatment or contr.poly for unset factors: cyl gear twolevel</span></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a><span class="co">#&gt; Warning in use_contrasts.function(factor_col = get(params[[&quot;factor_col&quot;]], : No</span></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a><span class="co">#&gt; comparison labels set and as_is=TRUE, contrast labels will be column indices.</span></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a><span class="co">#&gt; $carb</span></span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a><span class="co">#&gt;   [,1] [,2] [,3] [,4] [,5]</span></span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a><span class="co">#&gt; 1    1    0    0    0    0</span></span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a><span class="co">#&gt; 2    0    1    0    0    0</span></span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a><span class="co">#&gt; 3    0    0    1    0    0</span></span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a><span class="co">#&gt; 4    0    0    0    1    0</span></span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a><span class="co">#&gt; 5    0    0    0    0    1</span></span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a><span class="co">#&gt; 6   -1   -1   -1   -1   -1</span></span></code></pre></div>
<p>One last quick note is that you can keep the parentheses with the
function, so if your tab-autocomplete puts parentheses you don’t have to
worry about it.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="fu">enlist_contrasts</span>(mdl_data, carb <span class="sc">~</span> <span class="fu">contr.sum</span>())</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="co">#&gt; Expect contr.treatment or contr.poly for unset factors: cyl gear twolevel</span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a><span class="co">#&gt; $carb</span></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a><span class="co">#&gt;    2  3  4  6  8</span></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a><span class="co">#&gt; 1 -1 -1 -1 -1 -1</span></span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a><span class="co">#&gt; 2  1  0  0  0  0</span></span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a><span class="co">#&gt; 3  0  1  0  0  0</span></span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a><span class="co">#&gt; 4  0  0  1  0  0</span></span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a><span class="co">#&gt; 6  0  0  0  1  0</span></span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a><span class="co">#&gt; 8  0  0  0  0  1</span></span></code></pre></div>
<p>However, the function does need to exist; the following won’t
run:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>foo <span class="ot">&lt;-</span> <span class="fu">contr.sum</span>(<span class="dv">6</span>) <span class="co"># foo is a matrix</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a><span class="fu">enlist_contrasts</span>(mdl_data, carb <span class="sc">~</span> <span class="fu">foo</span>()) <span class="co"># foo is not a function</span></span></code></pre></div>
</div>
<div id="tidyselect-functions" class="section level3">
<h3>tidyselect functions</h3>
<p>If you know you’re going to use the same scheme for multiple
variables, but don’t need to set the reference level or labels for any
one in particular, you can use tidyselect functionality to set multiple
contrasts. I’ll show a few examples of how to do this.</p>
<p>First, you can specify multiple variables on the left hand side using
the <code>+</code> operator.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="co"># equivalent to: enlist_contrasts(mdl_data, cyl ~ sum_code, gear ~ sum_code)</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a><span class="fu">enlist_contrasts</span>(mdl_data, cyl <span class="sc">+</span> gear <span class="sc">~</span> sum_code)</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a><span class="co">#&gt; Expect contr.treatment or contr.poly for unset factors: carb twolevel</span></span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a><span class="co">#&gt; $cyl</span></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a><span class="co">#&gt;    6  8</span></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a><span class="co">#&gt; 4 -1 -1</span></span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a><span class="co">#&gt; 6  1  0</span></span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a><span class="co">#&gt; 8  0  1</span></span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a><span class="co">#&gt; $gear</span></span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a><span class="co">#&gt;    4  5</span></span>
<span id="cb19-12"><a href="#cb19-12" tabindex="-1"></a><span class="co">#&gt; 3 -1 -1</span></span>
<span id="cb19-13"><a href="#cb19-13" tabindex="-1"></a><span class="co">#&gt; 4  1  0</span></span>
<span id="cb19-14"><a href="#cb19-14" tabindex="-1"></a><span class="co">#&gt; 5  0  1</span></span></code></pre></div>
<p>You can also use selecting functions like the below:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="fu">enlist_contrasts</span>(mdl_data, <span class="fu">where</span>(is.factor) <span class="sc">~</span> sum_code)</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a><span class="co">#&gt; $cyl</span></span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a><span class="co">#&gt;    6  8</span></span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a><span class="co">#&gt; 4 -1 -1</span></span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a><span class="co">#&gt; 6  1  0</span></span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a><span class="co">#&gt; 8  0  1</span></span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a><span class="co">#&gt; $gear</span></span>
<span id="cb20-9"><a href="#cb20-9" tabindex="-1"></a><span class="co">#&gt;    4  5</span></span>
<span id="cb20-10"><a href="#cb20-10" tabindex="-1"></a><span class="co">#&gt; 3 -1 -1</span></span>
<span id="cb20-11"><a href="#cb20-11" tabindex="-1"></a><span class="co">#&gt; 4  1  0</span></span>
<span id="cb20-12"><a href="#cb20-12" tabindex="-1"></a><span class="co">#&gt; 5  0  1</span></span>
<span id="cb20-13"><a href="#cb20-13" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb20-14"><a href="#cb20-14" tabindex="-1"></a><span class="co">#&gt; $carb</span></span>
<span id="cb20-15"><a href="#cb20-15" tabindex="-1"></a><span class="co">#&gt;    2  3  4  6  8</span></span>
<span id="cb20-16"><a href="#cb20-16" tabindex="-1"></a><span class="co">#&gt; 1 -1 -1 -1 -1 -1</span></span>
<span id="cb20-17"><a href="#cb20-17" tabindex="-1"></a><span class="co">#&gt; 2  1  0  0  0  0</span></span>
<span id="cb20-18"><a href="#cb20-18" tabindex="-1"></a><span class="co">#&gt; 3  0  1  0  0  0</span></span>
<span id="cb20-19"><a href="#cb20-19" tabindex="-1"></a><span class="co">#&gt; 4  0  0  1  0  0</span></span>
<span id="cb20-20"><a href="#cb20-20" tabindex="-1"></a><span class="co">#&gt; 6  0  0  0  1  0</span></span>
<span id="cb20-21"><a href="#cb20-21" tabindex="-1"></a><span class="co">#&gt; 8  0  0  0  0  1</span></span>
<span id="cb20-22"><a href="#cb20-22" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb20-23"><a href="#cb20-23" tabindex="-1"></a><span class="co">#&gt; $twolevel</span></span>
<span id="cb20-24"><a href="#cb20-24" tabindex="-1"></a><span class="co">#&gt;    b</span></span>
<span id="cb20-25"><a href="#cb20-25" tabindex="-1"></a><span class="co">#&gt; a -1</span></span>
<span id="cb20-26"><a href="#cb20-26" tabindex="-1"></a><span class="co">#&gt; b  1</span></span>
<span id="cb20-27"><a href="#cb20-27" tabindex="-1"></a><span class="co"># see also enlist_contrasts(mdl_data, where(is.unordered) ~ sum_code)</span></span>
<span id="cb20-28"><a href="#cb20-28" tabindex="-1"></a><span class="co"># see also enlist_contrasts(mdl_data, where(is.numeric) ~ sum_code)</span></span></code></pre></div>
<p>This also lets you programmatically set contrasts like so:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a>these_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;cyl&quot;</span>, <span class="st">&quot;gear&quot;</span>)</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a><span class="fu">enlist_contrasts</span>(mdl_data, <span class="fu">all_of</span>(these_vars) <span class="sc">~</span> sum_code)</span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a><span class="co">#&gt; Expect contr.treatment or contr.poly for unset factors: carb twolevel</span></span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a><span class="co">#&gt; $cyl</span></span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a><span class="co">#&gt;    6  8</span></span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a><span class="co">#&gt; 4 -1 -1</span></span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a><span class="co">#&gt; 6  1  0</span></span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a><span class="co">#&gt; 8  0  1</span></span>
<span id="cb21-9"><a href="#cb21-9" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb21-10"><a href="#cb21-10" tabindex="-1"></a><span class="co">#&gt; $gear</span></span>
<span id="cb21-11"><a href="#cb21-11" tabindex="-1"></a><span class="co">#&gt;    4  5</span></span>
<span id="cb21-12"><a href="#cb21-12" tabindex="-1"></a><span class="co">#&gt; 3 -1 -1</span></span>
<span id="cb21-13"><a href="#cb21-13" tabindex="-1"></a><span class="co">#&gt; 4  1  0</span></span>
<span id="cb21-14"><a href="#cb21-14" tabindex="-1"></a><span class="co">#&gt; 5  0  1</span></span></code></pre></div>
<p>However, you have to ensure that no variables are duplicated. The
following are not allowed regardless of whether the right right hand
sides evaluate to the same contrast schemes.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="fu">enlist_contrasts</span>(mdl_data, </span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a>                 cyl <span class="sc">~</span> sum_code, </span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a>                 <span class="fu">where</span>(is.factor) <span class="sc">~</span> sum_code) <span class="co"># cyl is a factor for mdl_data</span></span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a><span class="fu">enlist_contrasts</span>(mdl_data, </span>
<span id="cb22-6"><a href="#cb22-6" tabindex="-1"></a>                 cyl <span class="sc">~</span> sum_code, </span>
<span id="cb22-7"><a href="#cb22-7" tabindex="-1"></a>                 cyl <span class="sc">+</span> gear <span class="sc">~</span> sum_code) <span class="co"># cyl can&#39;t be specified twice</span></span></code></pre></div>
<p>You can check out the tidyselect package for more information.
<code>is.unordered</code> is provided in this package as an analogue to
<code>is.ordered</code>.</p>
</div>
<div id="other-ways-to-set-contrasts" class="section level3">
<h3>Other ways to set contrasts</h3>
<p>You can also set contrasts using things other than a function.
Specifically, you can pass the following classes to <code>code_by</code>
in the two-sided formulas:</p>
<ul>
<li><code>array</code></li>
<li><code>matrix</code></li>
<li><code>hypr</code></li>
<li><code>function</code> (must return a contrast matrix, cannot be an
anonymous function)</li>
<li><code>symbol</code> (must evaluate to a contrast matrix though)</li>
</ul>
<p>If you’re using a custom matrix for a tricky analysis, then you can
specify the matrix yourself and then pass it to set_contrasts:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a>my_matrix <span class="ot">&lt;-</span> <span class="fu">contr.sum</span>(<span class="dv">6</span>) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a><span class="fu">enlist_contrasts</span>(mdl_data, carb <span class="sc">~</span> my_matrix)</span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a><span class="co">#&gt; Expect contr.treatment or contr.poly for unset factors: cyl gear twolevel</span></span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a><span class="co">#&gt; $carb</span></span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a><span class="co">#&gt;      1    2    3    4    6</span></span>
<span id="cb23-6"><a href="#cb23-6" tabindex="-1"></a><span class="co">#&gt; 1  0.5  0.0  0.0  0.0  0.0</span></span>
<span id="cb23-7"><a href="#cb23-7" tabindex="-1"></a><span class="co">#&gt; 2  0.0  0.5  0.0  0.0  0.0</span></span>
<span id="cb23-8"><a href="#cb23-8" tabindex="-1"></a><span class="co">#&gt; 3  0.0  0.0  0.5  0.0  0.0</span></span>
<span id="cb23-9"><a href="#cb23-9" tabindex="-1"></a><span class="co">#&gt; 4  0.0  0.0  0.0  0.5  0.0</span></span>
<span id="cb23-10"><a href="#cb23-10" tabindex="-1"></a><span class="co">#&gt; 6  0.0  0.0  0.0  0.0  0.5</span></span>
<span id="cb23-11"><a href="#cb23-11" tabindex="-1"></a><span class="co">#&gt; 8 -0.5 -0.5 -0.5 -0.5 -0.5</span></span></code></pre></div>
<p>You can also specify a list of formulas and pass that to different
functions.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a>my_contrasts <span class="ot">&lt;-</span> <span class="fu">list</span>(carb <span class="sc">~</span> contr.sum, gear <span class="sc">~</span> scaled_sum_code)</span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a><span class="fu">enlist_contrasts</span>(mdl_data, my_contrasts)</span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a><span class="co">#&gt; Expect contr.treatment or contr.poly for unset factors: cyl twolevel</span></span>
<span id="cb24-5"><a href="#cb24-5" tabindex="-1"></a><span class="co">#&gt; $carb</span></span>
<span id="cb24-6"><a href="#cb24-6" tabindex="-1"></a><span class="co">#&gt;    2  3  4  6  8</span></span>
<span id="cb24-7"><a href="#cb24-7" tabindex="-1"></a><span class="co">#&gt; 1 -1 -1 -1 -1 -1</span></span>
<span id="cb24-8"><a href="#cb24-8" tabindex="-1"></a><span class="co">#&gt; 2  1  0  0  0  0</span></span>
<span id="cb24-9"><a href="#cb24-9" tabindex="-1"></a><span class="co">#&gt; 3  0  1  0  0  0</span></span>
<span id="cb24-10"><a href="#cb24-10" tabindex="-1"></a><span class="co">#&gt; 4  0  0  1  0  0</span></span>
<span id="cb24-11"><a href="#cb24-11" tabindex="-1"></a><span class="co">#&gt; 6  0  0  0  1  0</span></span>
<span id="cb24-12"><a href="#cb24-12" tabindex="-1"></a><span class="co">#&gt; 8  0  0  0  0  1</span></span>
<span id="cb24-13"><a href="#cb24-13" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb24-14"><a href="#cb24-14" tabindex="-1"></a><span class="co">#&gt; $gear</span></span>
<span id="cb24-15"><a href="#cb24-15" tabindex="-1"></a><span class="co">#&gt;            4          5</span></span>
<span id="cb24-16"><a href="#cb24-16" tabindex="-1"></a><span class="co">#&gt; 3 -0.3333333 -0.3333333</span></span>
<span id="cb24-17"><a href="#cb24-17" tabindex="-1"></a><span class="co">#&gt; 4  0.6666667 -0.3333333</span></span>
<span id="cb24-18"><a href="#cb24-18" tabindex="-1"></a><span class="co">#&gt; 5 -0.3333333  0.6666667</span></span>
<span id="cb24-19"><a href="#cb24-19" tabindex="-1"></a>mdl_data12 <span class="ot">&lt;-</span> <span class="fu">set_contrasts</span>(mdl_data, my_contrasts)</span>
<span id="cb24-20"><a href="#cb24-20" tabindex="-1"></a><span class="co">#&gt; Expect contr.treatment or contr.poly for unset factors: cyl twolevel</span></span></code></pre></div>
<p>This functionality is very important for the next function I’ll
discuss.</p>
</div>
<div id="glimpse_contrasts" class="section level3">
<h3>glimpse_contrasts</h3>
<p>It can be very useful to get a summary of the different factors and
their contrasts in your dataset. The <code>glimpse_contrasts</code>
function does this for you by passing it your dataset and your
contrasts.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a>my_contrasts <span class="ot">&lt;-</span> <span class="fu">list</span>(carb <span class="sc">~</span> contr.sum,</span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a>                     gear <span class="sc">~</span> treatment_code <span class="sc">+</span> <span class="dv">4</span>,</span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a>                     twolevel <span class="sc">~</span> scaled_sum_code <span class="sc">*</span> <span class="st">&quot;b&quot;</span>,</span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a>                     cyl <span class="sc">~</span> helmert_code)</span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a>mdl_data<span class="sc">$</span>twolevel</span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a><span class="co">#&gt;  [1] a b a b a b a b a b a b a b a b a b a b a b a b a b a b a b a b</span></span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a><span class="co">#&gt; Levels: a b</span></span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" tabindex="-1"></a><span class="fu">enlist_contrasts</span>(mdl_data, cyl <span class="sc">~</span> scaled_sum_code <span class="sc">+</span> <span class="dv">6</span> <span class="sc">*</span> <span class="dv">6</span>)</span>
<span id="cb25-10"><a href="#cb25-10" tabindex="-1"></a><span class="co">#&gt; Expect contr.treatment or contr.poly for unset factors: gear carb twolevel</span></span>
<span id="cb25-11"><a href="#cb25-11" tabindex="-1"></a><span class="co">#&gt; $cyl</span></span>
<span id="cb25-12"><a href="#cb25-12" tabindex="-1"></a><span class="co">#&gt;   4 8</span></span>
<span id="cb25-13"><a href="#cb25-13" tabindex="-1"></a><span class="co">#&gt; 4 1 0</span></span>
<span id="cb25-14"><a href="#cb25-14" tabindex="-1"></a><span class="co">#&gt; 6 0 0</span></span>
<span id="cb25-15"><a href="#cb25-15" tabindex="-1"></a><span class="co">#&gt; 8 0 1</span></span>
<span id="cb25-16"><a href="#cb25-16" tabindex="-1"></a></span>
<span id="cb25-17"><a href="#cb25-17" tabindex="-1"></a>mdl_data13 <span class="ot">&lt;-</span> <span class="fu">set_contrasts</span>(mdl_data, my_contrasts)</span>
<span id="cb25-18"><a href="#cb25-18" tabindex="-1"></a></span>
<span id="cb25-19"><a href="#cb25-19" tabindex="-1"></a><span class="fu">glimpse_contrasts</span>(mdl_data13, my_contrasts)</span>
<span id="cb25-20"><a href="#cb25-20" tabindex="-1"></a><span class="co">#&gt;     factor n  level_names          scheme reference  intercept</span></span>
<span id="cb25-21"><a href="#cb25-21" tabindex="-1"></a><span class="co">#&gt; 1     carb 6 1, 2, 3,....       contr.sum         1 grand mean</span></span>
<span id="cb25-22"><a href="#cb25-22" tabindex="-1"></a><span class="co">#&gt; 2     gear 3      3, 4, 5  treatment_code         4    mean(4)</span></span>
<span id="cb25-23"><a href="#cb25-23" tabindex="-1"></a><span class="co">#&gt; 3 twolevel 2         a, b scaled_sum_code         a    mean(b)</span></span>
<span id="cb25-24"><a href="#cb25-24" tabindex="-1"></a><span class="co">#&gt; 4      cyl 3      4, 6, 8    helmert_code      &lt;NA&gt; grand mean</span></span></code></pre></div>
<p>Note that if you haven’t actually set your contrasts to the dataset,
you’ll receive a series of warnings:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="fu">glimpse_contrasts</span>(mdl_data, my_contrasts)</span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a><span class="co">#&gt; Warning: Contrasts for factors in `mdl_data` don&#39;t match matrices in formulas:</span></span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a><span class="co">#&gt;  - carb</span></span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a><span class="co">#&gt;  - gear</span></span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a><span class="co">#&gt;  - twolevel</span></span>
<span id="cb26-6"><a href="#cb26-6" tabindex="-1"></a><span class="co">#&gt;  - cyl</span></span>
<span id="cb26-7"><a href="#cb26-7" tabindex="-1"></a><span class="co">#&gt; To fix, be sure to run:</span></span>
<span id="cb26-8"><a href="#cb26-8" tabindex="-1"></a><span class="co">#&gt; mdl_data &lt;- set_contrasts(mdl_data, my_contrasts)</span></span>
<span id="cb26-9"><a href="#cb26-9" tabindex="-1"></a><span class="co">#&gt;     factor n  level_names          scheme reference  intercept</span></span>
<span id="cb26-10"><a href="#cb26-10" tabindex="-1"></a><span class="co">#&gt; 1     carb 6 1, 2, 3,....       contr.sum         1 grand mean</span></span>
<span id="cb26-11"><a href="#cb26-11" tabindex="-1"></a><span class="co">#&gt; 2     gear 3      3, 4, 5  treatment_code         4    mean(4)</span></span>
<span id="cb26-12"><a href="#cb26-12" tabindex="-1"></a><span class="co">#&gt; 3 twolevel 2         a, b scaled_sum_code         a    mean(b)</span></span>
<span id="cb26-13"><a href="#cb26-13" tabindex="-1"></a><span class="co">#&gt; 4      cyl 3      4, 6, 8    helmert_code      &lt;NA&gt; grand mean</span></span></code></pre></div>
<p>You can also specify the formulas directly, like with
<code>set_contrasts</code> and <code>enlist_contrasts</code>— but
usually you’ll want to have a list of formulas and pass this to the
different functions. Note how we retyped everything we typed above just
to get the summary table.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="fu">glimpse_contrasts</span>(mdl_data13, </span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a>                  carb <span class="sc">~</span> contr.sum,</span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a>                  gear <span class="sc">~</span> treatment_code <span class="sc">+</span> <span class="dv">4</span>,</span>
<span id="cb27-4"><a href="#cb27-4" tabindex="-1"></a>                  twolevel <span class="sc">~</span> scaled_sum_code <span class="sc">*</span> <span class="st">&quot;b&quot;</span>,</span>
<span id="cb27-5"><a href="#cb27-5" tabindex="-1"></a>                  cyl <span class="sc">~</span> helmert_code)</span>
<span id="cb27-6"><a href="#cb27-6" tabindex="-1"></a><span class="co">#&gt;     factor n  level_names          scheme reference  intercept</span></span>
<span id="cb27-7"><a href="#cb27-7" tabindex="-1"></a><span class="co">#&gt; 1     carb 6 1, 2, 3,....       contr.sum         1 grand mean</span></span>
<span id="cb27-8"><a href="#cb27-8" tabindex="-1"></a><span class="co">#&gt; 2     gear 3      3, 4, 5  treatment_code         4    mean(4)</span></span>
<span id="cb27-9"><a href="#cb27-9" tabindex="-1"></a><span class="co">#&gt; 3 twolevel 2         a, b scaled_sum_code         a    mean(b)</span></span>
<span id="cb27-10"><a href="#cb27-10" tabindex="-1"></a><span class="co">#&gt; 4      cyl 3      4, 6, 8    helmert_code      &lt;NA&gt; grand mean</span></span></code></pre></div>
<p>If you don’t provide any contrast information,
<code>glimpse_contrasts</code> will assume that factors should be using
their default contrasts. If the contrasts are not the same as the
defaults, you’ll receive warnings:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="fu">glimpse_contrasts</span>(mdl_data)  <span class="co"># no warnings</span></span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a><span class="co">#&gt;            factor n  level_names          scheme reference intercept orthogonal</span></span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a><span class="co">#&gt; cyl           cyl 3      4, 6, 8 contr.treatment         4   mean(4)      FALSE</span></span>
<span id="cb28-4"><a href="#cb28-4" tabindex="-1"></a><span class="co">#&gt; gear         gear 3      3, 4, 5 contr.treatment         3   mean(3)      FALSE</span></span>
<span id="cb28-5"><a href="#cb28-5" tabindex="-1"></a><span class="co">#&gt; carb         carb 6 1, 2, 3,.... contr.treatment         1   mean(1)      FALSE</span></span>
<span id="cb28-6"><a href="#cb28-6" tabindex="-1"></a><span class="co">#&gt; twolevel twolevel 2         a, b contr.treatment         a   mean(a)         NA</span></span>
<span id="cb28-7"><a href="#cb28-7" tabindex="-1"></a><span class="co">#&gt;          centered dropped_trends explicitly_set</span></span>
<span id="cb28-8"><a href="#cb28-8" tabindex="-1"></a><span class="co">#&gt; cyl         FALSE             NA          FALSE</span></span>
<span id="cb28-9"><a href="#cb28-9" tabindex="-1"></a><span class="co">#&gt; gear        FALSE             NA          FALSE</span></span>
<span id="cb28-10"><a href="#cb28-10" tabindex="-1"></a><span class="co">#&gt; carb        FALSE             NA          FALSE</span></span>
<span id="cb28-11"><a href="#cb28-11" tabindex="-1"></a><span class="co">#&gt; twolevel    FALSE             NA          FALSE</span></span>
<span id="cb28-12"><a href="#cb28-12" tabindex="-1"></a><span class="fu">glimpse_contrasts</span>(mdl_data13) <span class="co"># warnings</span></span>
<span id="cb28-13"><a href="#cb28-13" tabindex="-1"></a><span class="co">#&gt; Warning in .warn_if_nondefault(default_contrasts, unset_factors, factor_sizes, : Unset factors do not use default contr.treatment or contr.poly. Glimpse table may be unreliable.</span></span>
<span id="cb28-14"><a href="#cb28-14" tabindex="-1"></a><span class="co">#&gt;  - cyl</span></span>
<span id="cb28-15"><a href="#cb28-15" tabindex="-1"></a><span class="co">#&gt;  - gear</span></span>
<span id="cb28-16"><a href="#cb28-16" tabindex="-1"></a><span class="co">#&gt;  - carb</span></span>
<span id="cb28-17"><a href="#cb28-17" tabindex="-1"></a><span class="co">#&gt;  - twolevel</span></span>
<span id="cb28-18"><a href="#cb28-18" tabindex="-1"></a><span class="co">#&gt;            factor n  level_names scheme reference  intercept orthogonal</span></span>
<span id="cb28-19"><a href="#cb28-19" tabindex="-1"></a><span class="co">#&gt; cyl           cyl 3      4, 6, 8    ???      &lt;NA&gt; grand mean       TRUE</span></span>
<span id="cb28-20"><a href="#cb28-20" tabindex="-1"></a><span class="co">#&gt; gear         gear 3      3, 4, 5    ???         4    mean(4)      FALSE</span></span>
<span id="cb28-21"><a href="#cb28-21" tabindex="-1"></a><span class="co">#&gt; carb         carb 6 1, 2, 3,....    ???         1 grand mean      FALSE</span></span>
<span id="cb28-22"><a href="#cb28-22" tabindex="-1"></a><span class="co">#&gt; twolevel twolevel 2         a, b    ???         a    mean(b)         NA</span></span>
<span id="cb28-23"><a href="#cb28-23" tabindex="-1"></a><span class="co">#&gt;          centered dropped_trends explicitly_set</span></span>
<span id="cb28-24"><a href="#cb28-24" tabindex="-1"></a><span class="co">#&gt; cyl          TRUE             NA          FALSE</span></span>
<span id="cb28-25"><a href="#cb28-25" tabindex="-1"></a><span class="co">#&gt; gear        FALSE             NA          FALSE</span></span>
<span id="cb28-26"><a href="#cb28-26" tabindex="-1"></a><span class="co">#&gt; carb         TRUE             NA          FALSE</span></span>
<span id="cb28-27"><a href="#cb28-27" tabindex="-1"></a><span class="co">#&gt; twolevel     TRUE             NA          FALSE</span></span></code></pre></div>
<p>If there are mismatches between the data and the contrasts specified
by the formulas, you’ll also get warnings:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="fu">glimpse_contrasts</span>(mdl_data, </span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a>                  carb <span class="sc">~</span> contr.sum, </span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a>                  gear <span class="sc">~</span> treatment_code <span class="sc">*</span> <span class="dv">4</span>,</span>
<span id="cb29-4"><a href="#cb29-4" tabindex="-1"></a>                  cyl <span class="sc">~</span> contr.treatment <span class="sc">|</span> <span class="fu">c</span>(<span class="st">&quot;diff1&quot;</span>, <span class="st">&quot;diff2&quot;</span>))</span>
<span id="cb29-5"><a href="#cb29-5" tabindex="-1"></a><span class="co">#&gt; Expect contr.treatment or contr.poly for unset factors: twolevel</span></span>
<span id="cb29-6"><a href="#cb29-6" tabindex="-1"></a><span class="co">#&gt; Warning: Contrasts for factors in `mdl_data` don&#39;t match matrices in formulas:</span></span>
<span id="cb29-7"><a href="#cb29-7" tabindex="-1"></a><span class="co">#&gt;  - carb</span></span>
<span id="cb29-8"><a href="#cb29-8" tabindex="-1"></a><span class="co">#&gt;  - gear</span></span>
<span id="cb29-9"><a href="#cb29-9" tabindex="-1"></a><span class="co">#&gt; Comparison labels for contrasts in `mdl_data` don&#39;t match:</span></span>
<span id="cb29-10"><a href="#cb29-10" tabindex="-1"></a><span class="co">#&gt;  - cyl   (expected `diff1, diff2` but found `6, 8`)</span></span>
<span id="cb29-11"><a href="#cb29-11" tabindex="-1"></a><span class="co">#&gt; To fix, be sure to run:</span></span>
<span id="cb29-12"><a href="#cb29-12" tabindex="-1"></a><span class="co">#&gt; mdl_data &lt;- set_contrasts(mdl_data, </span></span>
<span id="cb29-13"><a href="#cb29-13" tabindex="-1"></a><span class="co">#&gt;                           carb ~ contr.sum,</span></span>
<span id="cb29-14"><a href="#cb29-14" tabindex="-1"></a><span class="co">#&gt;                           gear ~ treatment_code * 4,</span></span>
<span id="cb29-15"><a href="#cb29-15" tabindex="-1"></a><span class="co">#&gt;                           cyl ~ contr.treatment | c(&quot;diff1&quot;, &quot;diff2&quot;))</span></span>
<span id="cb29-16"><a href="#cb29-16" tabindex="-1"></a><span class="co">#&gt;            factor n  level_names          scheme reference  intercept</span></span>
<span id="cb29-17"><a href="#cb29-17" tabindex="-1"></a><span class="co">#&gt; 1            carb 6 1, 2, 3,....       contr.sum         1 grand mean</span></span>
<span id="cb29-18"><a href="#cb29-18" tabindex="-1"></a><span class="co">#&gt; 2            gear 3      3, 4, 5  treatment_code         4    mean(4)</span></span>
<span id="cb29-19"><a href="#cb29-19" tabindex="-1"></a><span class="co">#&gt; 3             cyl 3      4, 6, 8 contr.treatment         4    mean(4)</span></span>
<span id="cb29-20"><a href="#cb29-20" tabindex="-1"></a><span class="co">#&gt; twolevel twolevel 2         a, b contr.treatment         a    mean(a)</span></span></code></pre></div>
<p>Remember that <code>set_contrasts</code> will automatically coerce
dataframe columns into factors when specifying a contrast, but
<code>glimpse_contrasts</code> does <em>not</em> because it does not
modify the provided dataframe.</p>
</div>
<div id="note-on-polynomial-contrasts" class="section level3">
<h3>Note on polynomial contrasts</h3>
<p>There is an additional operator for the formulas that only applies to
polynomial contrasts. For background, polynomial contrasts encode
polynomial “trends” across the levels of a factor. So, testing for a
linear-like trend, a quadratic-like trend, etc. One thing you
<em>can</em> do, though I don’t necessarily <em>recommend</em> it is
removing higher-order trends. For instance, if you have 8 levels but
don’t want to bother with polynomials over degree 3 (even though you’ll
get up to degree 7 for “free”). In this situation you can use the
<code>-</code> operator:
<code>varname ~ code_by + reference * intercept - low:high | labels</code></p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="fu">enlist_contrasts</span>(mdl_data, carb <span class="sc">~</span> contr.poly)</span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a><span class="co">#&gt; Expect contr.treatment or contr.poly for unset factors: cyl gear twolevel</span></span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a><span class="co">#&gt; $carb</span></span>
<span id="cb30-4"><a href="#cb30-4" tabindex="-1"></a><span class="co">#&gt;           .L         .Q         .C         ^4          ^5</span></span>
<span id="cb30-5"><a href="#cb30-5" tabindex="-1"></a><span class="co">#&gt; 1 -0.5976143  0.5455447 -0.3726780  0.1889822 -0.06299408</span></span>
<span id="cb30-6"><a href="#cb30-6" tabindex="-1"></a><span class="co">#&gt; 2 -0.3585686 -0.1091089  0.5217492 -0.5669467  0.31497039</span></span>
<span id="cb30-7"><a href="#cb30-7" tabindex="-1"></a><span class="co">#&gt; 3 -0.1195229 -0.4364358  0.2981424  0.3779645 -0.62994079</span></span>
<span id="cb30-8"><a href="#cb30-8" tabindex="-1"></a><span class="co">#&gt; 4  0.1195229 -0.4364358 -0.2981424  0.3779645  0.62994079</span></span>
<span id="cb30-9"><a href="#cb30-9" tabindex="-1"></a><span class="co">#&gt; 6  0.3585686 -0.1091089 -0.5217492 -0.5669467 -0.31497039</span></span>
<span id="cb30-10"><a href="#cb30-10" tabindex="-1"></a><span class="co">#&gt; 8  0.5976143  0.5455447  0.3726780  0.1889822  0.06299408</span></span>
<span id="cb30-11"><a href="#cb30-11" tabindex="-1"></a><span class="fu">enlist_contrasts</span>(mdl_data, carb <span class="sc">~</span> contr.poly <span class="sc">-</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb30-12"><a href="#cb30-12" tabindex="-1"></a><span class="co">#&gt; Expect contr.treatment or contr.poly for unset factors: cyl gear twolevel</span></span>
<span id="cb30-13"><a href="#cb30-13" tabindex="-1"></a><span class="co">#&gt; $carb</span></span>
<span id="cb30-14"><a href="#cb30-14" tabindex="-1"></a><span class="co">#&gt;           .L         .Q</span></span>
<span id="cb30-15"><a href="#cb30-15" tabindex="-1"></a><span class="co">#&gt; 1 -0.5976143  0.5455447</span></span>
<span id="cb30-16"><a href="#cb30-16" tabindex="-1"></a><span class="co">#&gt; 2 -0.3585686 -0.1091089</span></span>
<span id="cb30-17"><a href="#cb30-17" tabindex="-1"></a><span class="co">#&gt; 3 -0.1195229 -0.4364358</span></span>
<span id="cb30-18"><a href="#cb30-18" tabindex="-1"></a><span class="co">#&gt; 4  0.1195229 -0.4364358</span></span>
<span id="cb30-19"><a href="#cb30-19" tabindex="-1"></a><span class="co">#&gt; 6  0.3585686 -0.1091089</span></span>
<span id="cb30-20"><a href="#cb30-20" tabindex="-1"></a><span class="co">#&gt; 8  0.5976143  0.5455447</span></span></code></pre></div>
<p>Note that you can ONLY use this with <code>enlist_contrasts</code>
and <code>glimpse_contrasts</code>. This is because if you remove
columns from a contrast matrix, R will fill them back with something
else.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a>mdl_data14 <span class="ot">&lt;-</span> <span class="fu">set_contrasts</span>(mdl_data, carb <span class="sc">~</span> contr.sum)</span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a><span class="co">#&gt; Expect contr.treatment or contr.poly for unset factors: cyl gear twolevel</span></span>
<span id="cb31-3"><a href="#cb31-3" tabindex="-1"></a><span class="fu">contrasts</span>(mdl_data14<span class="sc">$</span>carb)</span>
<span id="cb31-4"><a href="#cb31-4" tabindex="-1"></a><span class="co">#&gt;    2  3  4  6  8</span></span>
<span id="cb31-5"><a href="#cb31-5" tabindex="-1"></a><span class="co">#&gt; 1 -1 -1 -1 -1 -1</span></span>
<span id="cb31-6"><a href="#cb31-6" tabindex="-1"></a><span class="co">#&gt; 2  1  0  0  0  0</span></span>
<span id="cb31-7"><a href="#cb31-7" tabindex="-1"></a><span class="co">#&gt; 3  0  1  0  0  0</span></span>
<span id="cb31-8"><a href="#cb31-8" tabindex="-1"></a><span class="co">#&gt; 4  0  0  1  0  0</span></span>
<span id="cb31-9"><a href="#cb31-9" tabindex="-1"></a><span class="co">#&gt; 6  0  0  0  1  0</span></span>
<span id="cb31-10"><a href="#cb31-10" tabindex="-1"></a><span class="co">#&gt; 8  0  0  0  0  1</span></span>
<span id="cb31-11"><a href="#cb31-11" tabindex="-1"></a><span class="fu">contrasts</span>(mdl_data14<span class="sc">$</span>carb) <span class="ot">&lt;-</span> <span class="fu">contrasts</span>(mdl_data14<span class="sc">$</span>carb)[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb31-12"><a href="#cb31-12" tabindex="-1"></a><span class="fu">contrasts</span>(mdl_data14<span class="sc">$</span>carb)</span>
<span id="cb31-13"><a href="#cb31-13" tabindex="-1"></a><span class="co">#&gt;    2  3                                    </span></span>
<span id="cb31-14"><a href="#cb31-14" tabindex="-1"></a><span class="co">#&gt; 1 -1 -1 -0.23570226 -0.23570226 -0.23570226</span></span>
<span id="cb31-15"><a href="#cb31-15" tabindex="-1"></a><span class="co">#&gt; 2  1  0 -0.23570226 -0.23570226 -0.23570226</span></span>
<span id="cb31-16"><a href="#cb31-16" tabindex="-1"></a><span class="co">#&gt; 3  0  1 -0.23570226 -0.23570226 -0.23570226</span></span>
<span id="cb31-17"><a href="#cb31-17" tabindex="-1"></a><span class="co">#&gt; 4  0  0  0.90236893 -0.09763107 -0.09763107</span></span>
<span id="cb31-18"><a href="#cb31-18" tabindex="-1"></a><span class="co">#&gt; 6  0  0 -0.09763107  0.90236893 -0.09763107</span></span>
<span id="cb31-19"><a href="#cb31-19" tabindex="-1"></a><span class="co">#&gt; 8  0  0 -0.09763107 -0.09763107  0.90236893</span></span></code></pre></div>
<p>What do these values correspond to? If we check out the hypothesis
matrix, we can see that it seems like it’s trying to encode 0 but with
some floating point error:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a>MASS<span class="sc">::</span><span class="fu">fractions</span>(</span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a>  contrastable<span class="sc">:::</span><span class="fu">.convert_matrix</span>(</span>
<span id="cb32-3"><a href="#cb32-3" tabindex="-1"></a>    <span class="fu">contrasts</span>(mdl_data14<span class="sc">$</span>carb)</span>
<span id="cb32-4"><a href="#cb32-4" tabindex="-1"></a>  )</span>
<span id="cb32-5"><a href="#cb32-5" tabindex="-1"></a>)</span>
<span id="cb32-6"><a href="#cb32-6" tabindex="-1"></a><span class="co">#&gt;      [,1]              [,2]              [,3]              [,4]             </span></span>
<span id="cb32-7"><a href="#cb32-7" tabindex="-1"></a><span class="co">#&gt; [1,]               1/6              -1/3              -1/3  -1293633/5488420</span></span>
<span id="cb32-8"><a href="#cb32-8" tabindex="-1"></a><span class="co">#&gt; [2,]               1/6               2/3              -1/3  -1293633/5488420</span></span>
<span id="cb32-9"><a href="#cb32-9" tabindex="-1"></a><span class="co">#&gt; [3,]               1/6              -1/3               2/3  -1293633/5488420</span></span>
<span id="cb32-10"><a href="#cb32-10" tabindex="-1"></a><span class="co">#&gt; [4,]               1/6                 0                 0 11956585/13250218</span></span>
<span id="cb32-11"><a href="#cb32-11" tabindex="-1"></a><span class="co">#&gt; [5,]               1/6                 0                 0 -1293633/13250218</span></span>
<span id="cb32-12"><a href="#cb32-12" tabindex="-1"></a><span class="co">#&gt; [6,]               1/6                 0                 0 -1293633/13250218</span></span>
<span id="cb32-13"><a href="#cb32-13" tabindex="-1"></a><span class="co">#&gt;      [,5]              [,6]             </span></span>
<span id="cb32-14"><a href="#cb32-14" tabindex="-1"></a><span class="co">#&gt; [1,]  -1293633/5488420  -1293633/5488420</span></span>
<span id="cb32-15"><a href="#cb32-15" tabindex="-1"></a><span class="co">#&gt; [2,]  -1293633/5488420  -1293633/5488420</span></span>
<span id="cb32-16"><a href="#cb32-16" tabindex="-1"></a><span class="co">#&gt; [3,]  -1293633/5488420  -1293633/5488420</span></span>
<span id="cb32-17"><a href="#cb32-17" tabindex="-1"></a><span class="co">#&gt; [4,] -1293633/13250218 -1293633/13250218</span></span>
<span id="cb32-18"><a href="#cb32-18" tabindex="-1"></a><span class="co">#&gt; [5,] 11956585/13250218 -1293633/13250218</span></span>
<span id="cb32-19"><a href="#cb32-19" tabindex="-1"></a><span class="co">#&gt; [6,] -1293633/13250218 11956585/13250218</span></span></code></pre></div>
<p>This is why I don’t recommend actually using the <code>-</code>
operator. If you use something like <code>lm</code> to fit functions,
you can use the output from <code>enlist_contrasts</code> as the
argument to <code>contrasts</code>. Although, I’m pretty sure the model
matrix will just add in these values anyways. If you try to use the
<code>-</code> operator with <code>set_contrasts</code> you’ll get a
warning, and the <code>-</code> operator will be ignored:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a>mdl_data15 <span class="ot">&lt;-</span> <span class="fu">set_contrasts</span>(mdl_data, carb <span class="sc">~</span> polynomial_code <span class="sc">-</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a><span class="co">#&gt; Warning in .reinstate_dropped_trends(formulas): Ignoring dropped trends, `-` used in invalid context (use only with polynomial contrast functions):</span></span>
<span id="cb33-3"><a href="#cb33-3" tabindex="-1"></a><span class="co">#&gt; carb ~ polynomial_code - 3:5</span></span>
<span id="cb33-4"><a href="#cb33-4" tabindex="-1"></a><span class="co">#&gt; Expect contr.treatment or contr.poly for unset factors: cyl gear twolevel</span></span></code></pre></div>
</div>
</div>
<div id="decompose_contrasts" class="section level2">
<h2>decompose_contrasts</h2>
<p>This is somewhat related to the <code>-</code> operator described
above, but has more uses. When considering a factor with 3 levels,
you’ll end up with two coefficients in your model. In other words, a
single factor is “decomposed” behind the scenes into multiple numeric
predictors for the model matrix. Sometimes it can be helpful to work
directly with these decomposed predictors. For example, interactions in
GAM models with <code>mgcv</code> can often be a pain to work with, and
sometimes it’s easier to just group the interaction of two predictors
into a series of individual predictors. However, doing the matrix
multiplication one at a time (or trying to conceptualize how the
matrices fit together) can be difficult, especially when R’s model
matrix functionality can do it for us. <code>decompose_contrasts</code>
provides an interface to do such decomposition.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a>mdl_data16 <span class="ot">&lt;-</span> </span>
<span id="cb34-2"><a href="#cb34-2" tabindex="-1"></a>  mdl_data <span class="sc">|&gt;</span> </span>
<span id="cb34-3"><a href="#cb34-3" tabindex="-1"></a>  <span class="fu">set_contrasts</span>(cyl <span class="sc">~</span> helmert_code,</span>
<span id="cb34-4"><a href="#cb34-4" tabindex="-1"></a>                gear <span class="sc">~</span> helmert_code) <span class="sc">|&gt;</span> </span>
<span id="cb34-5"><a href="#cb34-5" tabindex="-1"></a>  <span class="fu">decompose_contrasts</span>(<span class="sc">~</span> cyl <span class="sc">*</span> gear) </span>
<span id="cb34-6"><a href="#cb34-6" tabindex="-1"></a><span class="co">#&gt; Expect contr.treatment or contr.poly for unset factors: carb twolevel</span></span>
<span id="cb34-7"><a href="#cb34-7" tabindex="-1"></a></span>
<span id="cb34-8"><a href="#cb34-8" tabindex="-1"></a><span class="co"># Look at the decomposed contrast columns</span></span>
<span id="cb34-9"><a href="#cb34-9" tabindex="-1"></a>mdl_data16 <span class="sc">|&gt;</span> </span>
<span id="cb34-10"><a href="#cb34-10" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">matches</span>(<span class="st">&quot;^cyl|gear&quot;</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb34-11"><a href="#cb34-11" tabindex="-1"></a>  <span class="fu">head</span>()</span>
<span id="cb34-12"><a href="#cb34-12" tabindex="-1"></a><span class="co">#&gt;   cyl gear cyl&lt;6      cyl&lt;8 gear&lt;4     gear&lt;5 cyl&lt;6:gear&lt;4 cyl&lt;8:gear&lt;4</span></span>
<span id="cb34-13"><a href="#cb34-13" tabindex="-1"></a><span class="co">#&gt; 1   6    4   0.5 -0.3333333    0.5 -0.3333333         0.25   -0.1666667</span></span>
<span id="cb34-14"><a href="#cb34-14" tabindex="-1"></a><span class="co">#&gt; 2   6    4   0.5 -0.3333333    0.5 -0.3333333         0.25   -0.1666667</span></span>
<span id="cb34-15"><a href="#cb34-15" tabindex="-1"></a><span class="co">#&gt; 3   4    4  -0.5 -0.3333333    0.5 -0.3333333        -0.25   -0.1666667</span></span>
<span id="cb34-16"><a href="#cb34-16" tabindex="-1"></a><span class="co">#&gt; 4   6    3   0.5 -0.3333333   -0.5 -0.3333333        -0.25    0.1666667</span></span>
<span id="cb34-17"><a href="#cb34-17" tabindex="-1"></a><span class="co">#&gt; 5   8    3   0.0  0.6666667   -0.5 -0.3333333         0.00   -0.3333333</span></span>
<span id="cb34-18"><a href="#cb34-18" tabindex="-1"></a><span class="co">#&gt; 6   6    3   0.5 -0.3333333   -0.5 -0.3333333        -0.25    0.1666667</span></span>
<span id="cb34-19"><a href="#cb34-19" tabindex="-1"></a><span class="co">#&gt;   cyl&lt;6:gear&lt;5 cyl&lt;8:gear&lt;5</span></span>
<span id="cb34-20"><a href="#cb34-20" tabindex="-1"></a><span class="co">#&gt; 1   -0.1666667    0.1111111</span></span>
<span id="cb34-21"><a href="#cb34-21" tabindex="-1"></a><span class="co">#&gt; 2   -0.1666667    0.1111111</span></span>
<span id="cb34-22"><a href="#cb34-22" tabindex="-1"></a><span class="co">#&gt; 3    0.1666667    0.1111111</span></span>
<span id="cb34-23"><a href="#cb34-23" tabindex="-1"></a><span class="co">#&gt; 4   -0.1666667    0.1111111</span></span>
<span id="cb34-24"><a href="#cb34-24" tabindex="-1"></a><span class="co">#&gt; 5    0.0000000   -0.2222222</span></span>
<span id="cb34-25"><a href="#cb34-25" tabindex="-1"></a><span class="co">#&gt; 6   -0.1666667    0.1111111</span></span></code></pre></div>
<p>The column names take the name from the labels, so these may not
always be easy to work with when there are special characters. You can
wrangle these or use something like the <code>{janitor}</code> package
as needed.</p>
<p>Here’s a comparison of using the <code>cyl</code> predictor normally
(which gives us two coefficients), and specifying the comparisons
separately after decomposing the contrasts:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a><span class="fu">coef</span>(<span class="fu">lm</span>(mpg <span class="sc">~</span> cyl, <span class="at">data =</span> mdl_data16))</span>
<span id="cb35-2"><a href="#cb35-2" tabindex="-1"></a><span class="co">#&gt; (Intercept)       cyl&lt;6       cyl&lt;8 </span></span>
<span id="cb35-3"><a href="#cb35-3" tabindex="-1"></a><span class="co">#&gt;   20.502165   -6.920779   -8.103247</span></span>
<span id="cb35-4"><a href="#cb35-4" tabindex="-1"></a><span class="fu">coef</span>(<span class="fu">lm</span>(mpg <span class="sc">~</span> <span class="st">`</span><span class="at">cyl&lt;6</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">cyl&lt;8</span><span class="st">`</span>, <span class="at">data =</span> mdl_data16))</span>
<span id="cb35-5"><a href="#cb35-5" tabindex="-1"></a><span class="co">#&gt; (Intercept)     `cyl&lt;6`     `cyl&lt;8` </span></span>
<span id="cb35-6"><a href="#cb35-6" tabindex="-1"></a><span class="co">#&gt;   20.502165   -6.920779   -8.103247</span></span>
<span id="cb35-7"><a href="#cb35-7" tabindex="-1"></a><span class="fu">coef</span>(<span class="fu">lm</span>(mpg <span class="sc">~</span> cyl <span class="sc">*</span> gear, <span class="at">data =</span> mdl_data16))</span>
<span id="cb35-8"><a href="#cb35-8" tabindex="-1"></a><span class="co">#&gt;  (Intercept)        cyl&lt;6        cyl&lt;8       gear&lt;4       gear&lt;5 cyl&lt;6:gear&lt;4 </span></span>
<span id="cb35-9"><a href="#cb35-9" tabindex="-1"></a><span class="co">#&gt;   19.7875000   -5.8083333   -8.5500000    0.7291667    1.9687500   -5.4250000 </span></span>
<span id="cb35-10"><a href="#cb35-10" tabindex="-1"></a><span class="co">#&gt; cyl&lt;8:gear&lt;4 cyl&lt;6:gear&lt;5 cyl&lt;8:gear&lt;5 </span></span>
<span id="cb35-11"><a href="#cb35-11" tabindex="-1"></a><span class="co">#&gt;   -5.9500000   -4.0375000           NA</span></span>
<span id="cb35-12"><a href="#cb35-12" tabindex="-1"></a><span class="fu">coef</span>(<span class="fu">lm</span>(mpg <span class="sc">~</span> </span>
<span id="cb35-13"><a href="#cb35-13" tabindex="-1"></a>          <span class="st">`</span><span class="at">cyl&lt;6</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">cyl&lt;8</span><span class="st">`</span> <span class="sc">+</span> </span>
<span id="cb35-14"><a href="#cb35-14" tabindex="-1"></a>          <span class="st">`</span><span class="at">gear&lt;4</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">gear&lt;5</span><span class="st">`</span> <span class="sc">+</span> </span>
<span id="cb35-15"><a href="#cb35-15" tabindex="-1"></a>          <span class="st">`</span><span class="at">cyl&lt;6:gear&lt;4</span><span class="st">`</span> <span class="sc">+</span> </span>
<span id="cb35-16"><a href="#cb35-16" tabindex="-1"></a>          <span class="st">`</span><span class="at">cyl&lt;8:gear&lt;4</span><span class="st">`</span> <span class="sc">+</span> </span>
<span id="cb35-17"><a href="#cb35-17" tabindex="-1"></a>          <span class="st">`</span><span class="at">cyl&lt;6:gear&lt;5</span><span class="st">`</span> <span class="sc">+</span></span>
<span id="cb35-18"><a href="#cb35-18" tabindex="-1"></a>          <span class="st">`</span><span class="at">cyl&lt;8:gear&lt;5</span><span class="st">`</span>, </span>
<span id="cb35-19"><a href="#cb35-19" tabindex="-1"></a>        <span class="at">data =</span> mdl_data16))</span>
<span id="cb35-20"><a href="#cb35-20" tabindex="-1"></a><span class="co">#&gt;    (Intercept)        `cyl&lt;6`        `cyl&lt;8`       `gear&lt;4`       `gear&lt;5` </span></span>
<span id="cb35-21"><a href="#cb35-21" tabindex="-1"></a><span class="co">#&gt;     19.7875000     -5.8083333     -8.5500000      0.7291667      1.9687500 </span></span>
<span id="cb35-22"><a href="#cb35-22" tabindex="-1"></a><span class="co">#&gt; `cyl&lt;6:gear&lt;4` `cyl&lt;8:gear&lt;4` `cyl&lt;6:gear&lt;5` `cyl&lt;8:gear&lt;5` </span></span>
<span id="cb35-23"><a href="#cb35-23" tabindex="-1"></a><span class="co">#&gt;     -5.4250000     -5.9500000     -4.0375000             NA</span></span></code></pre></div>
<p>If we <em>really</em> wanted to, we could use just one of the
comparisons, but note that this may give misleading results:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a><span class="fu">coef</span>(<span class="fu">lm</span>(mpg <span class="sc">~</span> <span class="st">`</span><span class="at">cyl&lt;6</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">cyl&lt;8</span><span class="st">`</span>, <span class="at">data =</span> mdl_data16))</span>
<span id="cb36-2"><a href="#cb36-2" tabindex="-1"></a><span class="co">#&gt; (Intercept)     `cyl&lt;6`     `cyl&lt;8` </span></span>
<span id="cb36-3"><a href="#cb36-3" tabindex="-1"></a><span class="co">#&gt;   20.502165   -6.920779   -8.103247</span></span>
<span id="cb36-4"><a href="#cb36-4" tabindex="-1"></a><span class="fu">coef</span>(<span class="fu">lm</span>(mpg <span class="sc">~</span> <span class="st">`</span><span class="at">cyl&lt;6</span><span class="st">`</span>, <span class="at">data =</span> mdl_data16)) <span class="co"># not the same estimate as the above</span></span>
<span id="cb36-5"><a href="#cb36-5" tabindex="-1"></a><span class="co">#&gt; (Intercept)     `cyl&lt;6` </span></span>
<span id="cb36-6"><a href="#cb36-6" tabindex="-1"></a><span class="co">#&gt;   19.556786   -8.541429</span></span></code></pre></div>
<p>This function can be especially valuable for pedagogical purposes, as
it shows how the qualitative labels in the factor data is converted into
numeric values for the model to work with.</p>
</div>
<div id="typical-patterns" class="section level2">
<h2>Typical patterns</h2>
<p>There are two general patterns you’ll take in analyses with this
package:</p>
<div id="pattern-1-no-glimpsing" class="section level3">
<h3>Pattern 1: No glimpsing</h3>
<p>Here’s a general usage pattern when you don’t want to use
<code>glimpse_contrasts</code>.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a>raw_data <span class="ot">&lt;-</span> mtcars <span class="co"># load raw data from a csv or something here</span></span>
<span id="cb37-2"><a href="#cb37-2" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" tabindex="-1"></a><span class="co"># wrangle data for your final model</span></span>
<span id="cb37-4"><a href="#cb37-4" tabindex="-1"></a>final_data <span class="ot">&lt;-</span> </span>
<span id="cb37-5"><a href="#cb37-5" tabindex="-1"></a>  mtcars <span class="sc">|&gt;</span> </span>
<span id="cb37-6"><a href="#cb37-6" tabindex="-1"></a>  <span class="co"># mutate(# ... some data wrangling transformations ..) |&gt; </span></span>
<span id="cb37-7"><a href="#cb37-7" tabindex="-1"></a>  <span class="fu">set_contrasts</span>(carb <span class="sc">~</span> sum_code) <span class="co"># set contrasts at the very end</span></span>
<span id="cb37-8"><a href="#cb37-8" tabindex="-1"></a><span class="co">#&gt; Converting to factors: carb</span></span>
<span id="cb37-9"><a href="#cb37-9" tabindex="-1"></a></span>
<span id="cb37-10"><a href="#cb37-10" tabindex="-1"></a>mdl <span class="ot">&lt;-</span> <span class="fu">lm</span>(mpg <span class="sc">~</span> carb, <span class="at">data =</span> final_data) <span class="co"># run model with contrasts set</span></span></code></pre></div>
</div>
<div id="pattern-2-with-information-about-contrasts" class="section level3">
<h3>Pattern 2: With information about contrasts</h3>
<p>Here’s a usage pattern if you wanted to, say, publish the contrast
matrices or report the glimpse table in a publication or
preregistration:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a>raw_data <span class="ot">&lt;-</span> mtcars <span class="co"># load raw data from a csv or something here</span></span>
<span id="cb38-2"><a href="#cb38-2" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" tabindex="-1"></a><span class="co"># specify contrasts up front</span></span>
<span id="cb38-4"><a href="#cb38-4" tabindex="-1"></a>my_contrasts <span class="ot">&lt;-</span> <span class="fu">list</span>(carb <span class="sc">~</span> sum_code,</span>
<span id="cb38-5"><a href="#cb38-5" tabindex="-1"></a>                     cyl  <span class="sc">~</span> scaled_sum_code,</span>
<span id="cb38-6"><a href="#cb38-6" tabindex="-1"></a>                     gear <span class="sc">~</span> sum_code)</span>
<span id="cb38-7"><a href="#cb38-7" tabindex="-1"></a></span>
<span id="cb38-8"><a href="#cb38-8" tabindex="-1"></a><span class="co"># wrangle data for your final model</span></span>
<span id="cb38-9"><a href="#cb38-9" tabindex="-1"></a>final_data <span class="ot">&lt;-</span> </span>
<span id="cb38-10"><a href="#cb38-10" tabindex="-1"></a>  mtcars <span class="sc">|&gt;</span> </span>
<span id="cb38-11"><a href="#cb38-11" tabindex="-1"></a>  <span class="co"># mutate(# ... some data wrangling transformations ..) |&gt; </span></span>
<span id="cb38-12"><a href="#cb38-12" tabindex="-1"></a>  <span class="fu">set_contrasts</span>(my_contrasts) <span class="co"># set contrasts at the very end</span></span>
<span id="cb38-13"><a href="#cb38-13" tabindex="-1"></a><span class="co">#&gt; Converting to factors: carb cyl gear</span></span>
<span id="cb38-14"><a href="#cb38-14" tabindex="-1"></a></span>
<span id="cb38-15"><a href="#cb38-15" tabindex="-1"></a><span class="co"># Show the matrices we&#39;re using</span></span>
<span id="cb38-16"><a href="#cb38-16" tabindex="-1"></a><span class="fu">enlist_contrasts</span>(final_data, my_contrasts)</span>
<span id="cb38-17"><a href="#cb38-17" tabindex="-1"></a><span class="co">#&gt; $carb</span></span>
<span id="cb38-18"><a href="#cb38-18" tabindex="-1"></a><span class="co">#&gt;    2  3  4  6  8</span></span>
<span id="cb38-19"><a href="#cb38-19" tabindex="-1"></a><span class="co">#&gt; 1 -1 -1 -1 -1 -1</span></span>
<span id="cb38-20"><a href="#cb38-20" tabindex="-1"></a><span class="co">#&gt; 2  1  0  0  0  0</span></span>
<span id="cb38-21"><a href="#cb38-21" tabindex="-1"></a><span class="co">#&gt; 3  0  1  0  0  0</span></span>
<span id="cb38-22"><a href="#cb38-22" tabindex="-1"></a><span class="co">#&gt; 4  0  0  1  0  0</span></span>
<span id="cb38-23"><a href="#cb38-23" tabindex="-1"></a><span class="co">#&gt; 6  0  0  0  1  0</span></span>
<span id="cb38-24"><a href="#cb38-24" tabindex="-1"></a><span class="co">#&gt; 8  0  0  0  0  1</span></span>
<span id="cb38-25"><a href="#cb38-25" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb38-26"><a href="#cb38-26" tabindex="-1"></a><span class="co">#&gt; $cyl</span></span>
<span id="cb38-27"><a href="#cb38-27" tabindex="-1"></a><span class="co">#&gt;            6          8</span></span>
<span id="cb38-28"><a href="#cb38-28" tabindex="-1"></a><span class="co">#&gt; 4 -0.3333333 -0.3333333</span></span>
<span id="cb38-29"><a href="#cb38-29" tabindex="-1"></a><span class="co">#&gt; 6  0.6666667 -0.3333333</span></span>
<span id="cb38-30"><a href="#cb38-30" tabindex="-1"></a><span class="co">#&gt; 8 -0.3333333  0.6666667</span></span>
<span id="cb38-31"><a href="#cb38-31" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb38-32"><a href="#cb38-32" tabindex="-1"></a><span class="co">#&gt; $gear</span></span>
<span id="cb38-33"><a href="#cb38-33" tabindex="-1"></a><span class="co">#&gt;    4  5</span></span>
<span id="cb38-34"><a href="#cb38-34" tabindex="-1"></a><span class="co">#&gt; 3 -1 -1</span></span>
<span id="cb38-35"><a href="#cb38-35" tabindex="-1"></a><span class="co">#&gt; 4  1  0</span></span>
<span id="cb38-36"><a href="#cb38-36" tabindex="-1"></a><span class="co">#&gt; 5  0  1</span></span>
<span id="cb38-37"><a href="#cb38-37" tabindex="-1"></a></span>
<span id="cb38-38"><a href="#cb38-38" tabindex="-1"></a><span class="co"># Show a summary</span></span>
<span id="cb38-39"><a href="#cb38-39" tabindex="-1"></a><span class="fu">glimpse_contrasts</span>(final_data, my_contrasts)</span>
<span id="cb38-40"><a href="#cb38-40" tabindex="-1"></a><span class="co">#&gt;   factor n  level_names          scheme reference  intercept</span></span>
<span id="cb38-41"><a href="#cb38-41" tabindex="-1"></a><span class="co">#&gt; 1   carb 6 1, 2, 3,....        sum_code         1 grand mean</span></span>
<span id="cb38-42"><a href="#cb38-42" tabindex="-1"></a><span class="co">#&gt; 2    cyl 3      4, 6, 8 scaled_sum_code         4 grand mean</span></span>
<span id="cb38-43"><a href="#cb38-43" tabindex="-1"></a><span class="co">#&gt; 3   gear 3      3, 4, 5        sum_code         3 grand mean</span></span>
<span id="cb38-44"><a href="#cb38-44" tabindex="-1"></a></span>
<span id="cb38-45"><a href="#cb38-45" tabindex="-1"></a><span class="co"># Fit the model with contrasts set</span></span>
<span id="cb38-46"><a href="#cb38-46" tabindex="-1"></a>mdl <span class="ot">&lt;-</span> <span class="fu">lm</span>(mpg <span class="sc">~</span> carb, <span class="at">data =</span> final_data)</span></code></pre></div>
<p>If you want to show fractions instead of decimals, use
<code>MASS::fractions</code> with each element of the list of
contrasts:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" tabindex="-1"></a><span class="fu">enlist_contrasts</span>(final_data, my_contrasts) <span class="sc">|&gt;</span> </span>
<span id="cb39-2"><a href="#cb39-2" tabindex="-1"></a>  <span class="fu">lapply</span>(MASS<span class="sc">::</span>fractions)</span>
<span id="cb39-3"><a href="#cb39-3" tabindex="-1"></a><span class="co">#&gt; $carb</span></span>
<span id="cb39-4"><a href="#cb39-4" tabindex="-1"></a><span class="co">#&gt;   2  3  4  6  8 </span></span>
<span id="cb39-5"><a href="#cb39-5" tabindex="-1"></a><span class="co">#&gt; 1 -1 -1 -1 -1 -1</span></span>
<span id="cb39-6"><a href="#cb39-6" tabindex="-1"></a><span class="co">#&gt; 2  1  0  0  0  0</span></span>
<span id="cb39-7"><a href="#cb39-7" tabindex="-1"></a><span class="co">#&gt; 3  0  1  0  0  0</span></span>
<span id="cb39-8"><a href="#cb39-8" tabindex="-1"></a><span class="co">#&gt; 4  0  0  1  0  0</span></span>
<span id="cb39-9"><a href="#cb39-9" tabindex="-1"></a><span class="co">#&gt; 6  0  0  0  1  0</span></span>
<span id="cb39-10"><a href="#cb39-10" tabindex="-1"></a><span class="co">#&gt; 8  0  0  0  0  1</span></span>
<span id="cb39-11"><a href="#cb39-11" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb39-12"><a href="#cb39-12" tabindex="-1"></a><span class="co">#&gt; $cyl</span></span>
<span id="cb39-13"><a href="#cb39-13" tabindex="-1"></a><span class="co">#&gt;   6    8   </span></span>
<span id="cb39-14"><a href="#cb39-14" tabindex="-1"></a><span class="co">#&gt; 4 -1/3 -1/3</span></span>
<span id="cb39-15"><a href="#cb39-15" tabindex="-1"></a><span class="co">#&gt; 6  2/3 -1/3</span></span>
<span id="cb39-16"><a href="#cb39-16" tabindex="-1"></a><span class="co">#&gt; 8 -1/3  2/3</span></span>
<span id="cb39-17"><a href="#cb39-17" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb39-18"><a href="#cb39-18" tabindex="-1"></a><span class="co">#&gt; $gear</span></span>
<span id="cb39-19"><a href="#cb39-19" tabindex="-1"></a><span class="co">#&gt;   4  5 </span></span>
<span id="cb39-20"><a href="#cb39-20" tabindex="-1"></a><span class="co">#&gt; 3 -1 -1</span></span>
<span id="cb39-21"><a href="#cb39-21" tabindex="-1"></a><span class="co">#&gt; 4  1  0</span></span>
<span id="cb39-22"><a href="#cb39-22" tabindex="-1"></a><span class="co">#&gt; 5  0  1</span></span></code></pre></div>
<p>If you use the <code>targets</code> package, you can set up the list
of contrasts as its own target, then pass that to other targets so that
your analyses will be rerun whenever you change the contrasts (though
this shouldn’t happen frequently).</p>
</div>
</div>
<div id="conclusion" class="section level2">
<h2>Conclusion</h2>
<p>I discussed the main functions in this package and the special syntax
that is implemented to set contrasts. If you want additional examples,
see my blog posts below:</p>
<ul>
<li><a href="https://tsostaricsblog.netlify.app/posts/contrastable/">Introduction
to Contrasts using Contrastable</a></li>
<li><a href="On%20Helmert%20Coding">https://tsostaricsblog.netlify.app/posts/helmert/</a></li>
</ul>
<p>If you need additional information regarding the various warnings and
messages this package throws, you can check out the
<code>warnings</code> vignette in this package.</p>
</div>
<div id="citation-examples" class="section level2">
<h2>Citation examples</h2>
<p>When citing the package in a paper, ideally three things are
achieved:</p>
<ul>
<li>Mention the contrastable R package (Sostarics, 2024)</li>
<li>Mention which contrast scheme is used for each variable with
reference levels as appropriate</li>
<li>Disambiguate the term “sum coding” when used</li>
</ul>
<p>In a paper with multiple analyses, these don’t necessarily need to
all be mentioned on each analysis, especially when there are
commonalities between them.</p>
<p>Bad <em>on first mention</em>: “Condition and group are sum coded.”
(this can be fine if “sum code” is defined previously)</p>
<p>Good: “Condition is coded using the <code>sum_code()</code> function
from the contrastable package (Sostarics 2024), using A as the reference
level. Group is similarly sum coded, with X as the reference level.”</p>
<p>Also good: “For all of our analyses, we use the contrastable package
(Sostarics, 2024) to set the contrasts for our categorical variables.
Condition and group are sum coded (reference level -1, comparisons +1)
with A and X as the reference levels, respectively.” The point here is
to disambiguate what is meant by “sum code”, which has inconsistent
usage in the literature.</p>
<p>Here’s a paragraph example describing two models:</p>
<p>A bit repetitive: “In the model for Experiment 1, Condition is
treatment coded using the <code>treatment_code()</code> function from
the contrastable package (Sostarics, 2024), with A as the reference, and
Group is scaled sum coded using the <code>scaled_sum_code()</code>
function from the contrastable package, with X as the reference. In the
model for Experiment 2, Condition is treatment coded with the
<code>treatment_code()</code> function (reference=A) and Group is scaled
sum coded with <code>scaled_sum_code()</code> (reference=X), while the
additional Context predictor is scaled sum coded using the
<code>scaled_sum_code()</code> function (reference=NoContext).”</p>
<p>Rewritten: “We use the treatment_code() and scaled_sum_code()
functions from the contrastable package (Sostarics, 2024) when setting
the contrasts for our categorical variables. In the model for Experiment
1, Condition is treatment coded (reference=A) and Group is scaled sum
coded (reference=X). For Experiment 2, the additional Context predictor
is scaled sum coded (reference=NoContext); as in Exp. 1, Condition is
treatment coded (reference=A) and Group is sum coded (reference=X).”</p>
<p>Other examples:</p>
<ul>
<li>For all variables, contrasts were set using the
<code>scaled_sum_code()</code> function from the contrastable package
(Sostarics 2024).</li>
<li>We use the contrastable package (Sostarics 2024) for contrast coding
our categorical variables; details of the contrasts for each model are
provided in the appendix. (be sure to do the latter!)</li>
<li>Below are the contrast matrices returned by the
<code>helmert_code()</code> and <code>scaled_sum_code()</code> functions
from the contrastable R package (Sostarics 2024)</li>
<li>We use the <code>set_contrasts()</code> and <code>sum_code()</code>
functions from the contrastable package (Sostarics 2024) to sum code
(+1/-1) our variables</li>
</ul>
<p>I also recommend writing out, potentially in a footnote, what the
comparisons are.</p>
<p>Good: “We use the contrastable package’s <code>sum_code()</code>
function (+1/-1, Sostarics 2024) for all categorical variables.”</p>
<p>Better: “We use the contrastable package’s <code>sum_code()</code>
function (+1/-1, Sostarics 2024) for all categorical variables. This
contrast scheme encodes differences between each comparison level and
the grand mean.”</p>
</div>
<div class="footnotes footnotes-end-of-document">
<hr />
<ol>
<li id="fn1"><p>Technically, due to degrees of freedom, we’d compare
only 2 of the 3 levels to the average.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
